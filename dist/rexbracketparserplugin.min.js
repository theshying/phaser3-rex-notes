!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexbracketparserplugin=e()}(void 0,function(){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,n){e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1})}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");e=t;if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(n);return a(this,i?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function n(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function c(t,e,n){if(t&&"number"!=typeof t){if(t.hasOwnProperty(e))return t[e];if(-1===e.indexOf("."))return n;for(var i=e.split("."),r=t,s=n,o=0;o<i.length;o++){if(!r.hasOwnProperty(i[o])){s=n;break}s=r[i[o]],r=r[i[o]]}return s}return n}function f(t){return t.replace(e,"\\$&").replace(m,"\\x2d")}function v(t){return"string"==typeof t&&(""===t?t=null:d.test(t)?t=parseFloat(t):"false"===t?t=!1:"true"===t&&(t=!0)),t}function p(t){return t}var t={setEventEmitter:function(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter:function(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter:function(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},e=/[|\\{}()[\]^$+*?.]/g,m=/-/g,d=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,y=function(){function e(t){r(this,e),this.setEventEmitter(c(t,"eventEmitter",void 0)),this.setTagExpression(c(t,"regex.tag","[a-z0-9-_.]+")),this.setValueExpression(c(t,"regex.value","[ #a-z-_.0-9,|&]+")),this.setValueConverter(c(t,"valueConvert",!0));t=c(t,"delimiters","<>");this.setDelimiters(t[0],t[1]),this.isRunning=!1,this.isPaused=!1,this.skipEventFlag=!1,this.lastTagStart=null,this.lastTagEnd=null,this.lastContent=null}return s(e,[{key:"shutdown",value:function(){this.destroyEventEmitter()}},{key:"destroy",value:function(){this.shutdown()}},{key:"setTagExpression",value:function(t){return this.tagExpression=t,this}},{key:"setValueExpression",value:function(t){return this.valueExpression=t,this}},{key:"setValueConverter",value:function(t){return this.valueConverter=t=!0===t?v:t||p,this}},{key:"setDelimiters",value:function(t,e){void 0===e&&(e=t[1],t=t[0]),this.delimiterLeft=t,this.delimiterRight=e,t=f(t),e=f(e);var n="".concat(t,"(").concat(this.tagExpression,")(=(").concat(this.valueExpression,"))?").concat(e),t="".concat(t,"/(").concat(this.tagExpression,")").concat(e);return this.reTagOn=RegExp(n,"i"),this.reTagOff=RegExp(t,"i"),this.reSplit=RegExp("".concat(n,"|").concat(t),"gi"),this}},{key:"setSource",value:function(t){return this.source=t,this}},{key:"resetIndex",value:function(t){return this.progressIndex=t=void 0===t?0:t,this.reSplit.lastIndex=t,this.lastTagStart=null,this.lastTagEnd=null,this.lastContent=null,this}},{key:"start",value:function(t){return this.setSource(t).restart(),this}},{key:"restart",value:function(){this.resetIndex().next()}},{key:"next",value:function(){this.isPaused&&this.onResume(),0===this.reSplit.lastIndex&&this.onStart();for(var t=this.source,e=t.length;!this.isPaused;){var n=this.reSplit.exec(t);if(!n)return this.progressIndex<e&&this.onContent(t.substring(this.progressIndex,e)),void this.onComplete();var n=n[0],i=this.reSplit.lastIndex-n.length;this.progressIndex<i&&this.onContent(t.substring(this.progressIndex,i)),this.reTagOff.test(n)?this.onTagEnd(n):this.onTagStart(n),this.progressIndex=this.reSplit.lastIndex}}},{key:"skipEvent",value:function(){return this.skipEventFlag=!0,this}},{key:"pause",value:function(){return this.isPaused||this.onPause(),this}},{key:"onContent",value:function(t){this.skipEventFlag=!1,this.emit("content",t),this.lastContent=t}},{key:"onTagStart",value:function(t){var t=t.match(this.reTagOn),e=t[1],t=function(t,e){if(null==t)return[];for(var n=t.split(","),i=0,r=n.length;i<r;i++)n[i]=e(n[i]);return n}(t[3],this.valueConverter);this.skipEventFlag=!1,this.emit.apply(this,["+".concat(e)].concat(n(t))),this.skipEventFlag||this.emit.apply(this,["+",e].concat(n(t))),this.lastTagStart=e}},{key:"onTagEnd",value:function(t){t=t.match(this.reTagOff)[1];this.skipEventFlag=!1,this.emit("-".concat(t)),this.skipEventFlag||this.emit("-",t),this.lastTagEnd=t}},{key:"onStart",value:function(){this.isRunning=!0,this.emit("start",this)}},{key:"onComplete",value:function(){this.isRunning=!1,this.emit("complete",this),this.resetIndex()}},{key:"onPause",value:function(){this.isPaused=!0,this.emit("pause",this)}},{key:"onResume",value:function(){this.isPaused=!1,this.emit("resume",this)}},{key:"getTagOnRegString",value:function(t,e){return void 0===t&&(t=this.tagExpression),void 0===e&&(e=this.valueExpression),"".concat(f(this.delimiterLeft),"(").concat(t,")(=(").concat(e,"))?").concat(f(this.delimiterRight))}},{key:"getTagOffRegString",value:function(t){return void 0===t&&(t=this.tagExpression),"".concat(f(this.delimiterLeft),"/(").concat(t,")").concat(f(this.delimiterRight))}}]),e}();return Object.assign(y.prototype,t),function(t){var e=i;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t);var n=h(i);function i(t){return r(this,i),n.call(this,t)}return s(i,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"add",value:function(t){return new y(t)}}]),i}(Phaser.Plugins.BasePlugin)});
