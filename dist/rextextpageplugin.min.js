!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rextextpageplugin=e()}(void 0,function(){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function t(t,e,n){e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1})}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&n(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");e=t;if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=a(n);return h(this,i?(t=a(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function e(){return(e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=a(t)););return t}(t,e);if(i)return i=Object.getOwnPropertyDescriptor(i,e),i.get?i.get.call(arguments.length<3?t:n):i.value}).apply(this,arguments)}function c(t){return t=E(t)?_:m(t)?P:L}function p(t,e,n){switch(c(t)){case P:n=t.getWrappedText(e);break;case L:n=t.getPenManager(e,n);break;case _:n=(0<t.maxWidth?t.setText(e).getTextBounds().wrappedText:e).split("\n")}return n}function f(t){return Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t}var l={setEventEmitter:function(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter:function(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter:function(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},d=Phaser.Scene,y=function(t){return t instanceof d},g=Phaser.Utils.Objects.GetValue,v=function(){function n(t,e){s(this,n),this.parent=t,this.scene=null==(t=t)||"object"!==i(t)?null:y(t)?t:t.scene&&y(t.scene)?t.scene:t.parent&&t.parent.scene&&y(t.parent.scene)?t.parent.scene:void 0,this.isShutdown=!1,this.setEventEmitter(g(e,"eventEmitter",!0)),this.parent&&this.parent===this.scene?this.scene.sys.events.once("shutdown",this.onSceneDestroy,this):this.parent&&this.parent.once&&this.parent.once("destroy",this.onParentDestroy,this)}return t(n,[{key:"shutdown",value:function(t){this.isShutdown||(this.parent&&this.parent===this.scene?this.scene.sys.events.off("shutdown",this.onSceneDestroy,this):this.parent&&this.parent.once&&this.parent.off("destroy",this.onParentDestroy,this),this.destroyEventEmitter(),this.parent=void 0,this.scene=void 0,this.isShutdown=!0)}},{key:"destroy",value:function(t){this.shutdown(t)}},{key:"onSceneDestroy",value:function(){this.destroy(!0)}},{key:"onParentDestroy",value:function(t,e){this.destroy(e)}}]),n}(),x=(Object.assign(v.prototype,l),Phaser.GameObjects.Text),m=function(t){return t instanceof x},b=Phaser.GameObjects.BitmapText,E=function(t){return t instanceof b},P=0,L=1,_=2,w=Phaser.Math.Clamp,l={getLines:function(t,e){switch(void 0===t&&(t=this.startLineIndex),void 0===e&&(e=t+this.pageLinesCount),this.textObjectType){case P:case _:s=this.lines.slice(t,e).join("\n");break;case L:var n=this.lines.getLineStartIndex(t),i=this.lines.getLineEndIndex(e-1),s=this.lines.getSliceTagText(n,i,!0)}return s}},k=(Object.assign(l,{clearText:function(){return this.sections.length=0,this.pageStartIndexes.length=0,this.lines.length=0,this},appendPage:function(t){for(var e=this.totalLinesCount,t=(this.sections.push(f(t)),this.sections.join("\n")),t=(this.lines=p(this.parent,t,this.lines),this.totalLinesCount-e),n=Math.ceil(t/this.pageLinesCount),i=0;i<n;i++)this.pageStartIndexes.push(e+i*this.pageLinesCount);return this},setText:function(t,e){(e=void 0===e?!0:e)&&this.resetPageIdx(),this.clearText();for(var n=f(t).split(this.pageBreak),i=0,s=n.length;i<s;i++)this.appendPage(n[i]);return this},appendText:function(t){t=this.content+f(t);return this.setText(t,!1),this}},{getPage:function(t){return void 0===t&&(t=this.pageIndex),this.setPageIndex(t).getLines(this.startLineIndex,this.endLineIndex)},getNextPage:function(){return this.getPage(this.pageIndex+1)},getPreviousPage:function(){return this.getPage(this.pageIndex-1)},resetPageIdx:function(){return this.pageIndex=-1,this},setPageIndex:function(t){return t=w(t,0,this.pageCount-1),this.pageIndex=t,this.startLineIndex=this.pageStartIndexes[t],this.endLineIndex=this.pageStartIndexes[t+1],this}},{showPage:function(t){return this.displayText(this.getPage(t)),this},showNextPage:function(){return this.displayText(this.getNextPage()),this},showPreviousPage:function(){return this.displayText(this.getPreviousPage()),this},show:function(){return this.displayText(this.getLines()),this},showNextLine:function(){return this.displayText(this.setStartLineIndex(this.startLineIndex+1).getLines()),this},showPreviousLine:function(){return this.displayText(this.setStartLineIndex(this.startLineIndex-1).getLines()),this},displayText:function(t){var e=this.parent,n=t;switch(c(e)){case P:var i=(r=e.style).wordWrapWidth,s=r.wordWrapCallback;r.wordWrapWidth=0,r.wordWrapCallback=void 0,e.setText(n),r.wordWrapWidth=i,r.wordWrapCallback=s;break;case L:var r,i=(r=e.style).wrapMode;r.wrapMode=0,e.setText(n),r.wrapMode=i;break;case _:s=e._maxWidth;e._maxWidth=0,e.setText(n),e._maxWidth=s}}}),Phaser.Utils.Objects.GetValue),I=Phaser.Math.Clamp,O=function(){o(i,v);var n=u(i);function i(t,e){return s(this,i),(t=n.call(this,t,{eventEmitter:!1})).textObjectType=c(t.parent),t.pageStartIndexes=[],t.lines=p(t.parent,""),t.sections=[],t.resetFromJSON(e),t}return t(i,[{key:"resetFromJSON",value:function(t){return this.setMaxLines(k(t,"maxLines",void 0)),this.setPageBreak(k(t,"pageBreak","\f\n")),this.setText(k(t,"text","")),this.setStartLineIndex(k(t,"start",0)),this.setPageIndex(k(t,"page",-1)),this}},{key:"toJSON",value:function(){return{maxLines:this.maxLines,text:this.content,start:this.startLineIndex,page:this.pageIndex,pageBreak:this.pageBreak}}},{key:"shutdown",value:function(t){if(!this.isShutdown){switch(this.textObjectType){case P:this.lines.length=0;break;case L:this.lines.destroy();break;case _:this.lines.length=0}this.pageStartIndexes.length=0,this.sections.length=0,this.lines=void 0,this.pageStartIndexes=void 0,this.sections=void 0,e(a(i.prototype),"shutdown",this).call(this,t)}}},{key:"setMaxLines",value:function(t){return this.maxLines=t,this}},{key:"setPageBreak",value:function(t){return this.pageBreak=t,this}},{key:"pageCount",get:function(){return this.pageStartIndexes.length}},{key:"isFirstPage",get:function(){return this.pageIndex<=0}},{key:"isLastPage",get:function(){return this.pageIndex>=this.pageCount-1}},{key:"totalLinesCount",get:function(){return this.lines?this.lines.length:0}},{key:"startLineIndex",get:function(){return this._startLineIndex},set:function(t){t=I(t,0,this.totalLinesCount-1),this._startLineIndex=t}},{key:"setStartLineIndex",value:function(t){return this.startLineIndex=t,this}},{key:"pageLinesCount",get:function(){if(void 0!==this.maxLines)return this.maxLines;switch(this.textObjectType){case P:case L:var t=this.parent.style.maxLines,e=0<t?t:this.totalLinesCount;break;case _:e=this.totalLinesCount}return e}},{key:"content",get:function(){return this.sections.join(this.pageBreak)}}]),i}();return Object.assign(O.prototype,l),function(){o(n,Phaser.Plugins.BasePlugin);var e=u(n);function n(t){return s(this,n),e.call(this,t)}return t(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"add",value:function(t,e){return new O(t,e)}}]),n}()});
