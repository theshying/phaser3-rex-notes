!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rextagplayerplugin=e()}(void 0,function(){function I(t){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function B(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){e&&B(t.prototype,e),n&&B(t,n),Object.defineProperty(t,"prototype",{writable:!1})}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&L(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function L(t,e){return(L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=f(n),e=(t=i?(t=f(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}}function v(){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}(t,e);if(i)return i=Object.getOwnPropertyDescriptor(i,e),i.get?i.get.call(arguments.length<3?t:n):i.value}).apply(this,arguments)}function u(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function n(t,e,n){if(t&&"number"!=typeof t){if(t.hasOwnProperty(e))return t[e];if(-1===e.indexOf("."))return n;for(var i=e.split("."),s=t,r=n,a=0;a<i.length;a++){if(!s.hasOwnProperty(i[a])){r=n;break}r=s[i[a]],s=s[i[a]]}return r}return n}function s(t){return t.replace(tt,"\\$&").replace(et,"\\x2d")}function V(t){return"string"==typeof t&&(""===t?t=null:nt.test(t)?t=parseFloat(t):"false"===t?t=!1:"true"===t&&(t=!0)),t}function D(t){return t}function N(t,e){return 2===t.length&&t[0]===e}function U(t,e){return 3===t.length&&t[0]===e&&"play"===t[2]}function W(t,e){return 2===t.length&&t[0]===e}function J(t,e){return 3===t.length&&t[0]===e&&"text"===t[2]}function z(t,e){return 3===t.length&&t[0]===e&&"typing"===t[2]}function $(t,e,n,i,s){var r,i={mode:0,volume:{start:s=void 0===s?0:s,end:i=void 0===i?1:i},duration:n};(e="string"==typeof e?t.sys.sound.add(e):e).hasOwnProperty("_fade")?(r=e._fade).stop().resetFromJSON(i):(r=new Rt(t,e,i),e._fade=r),r.start(),e.isPlaying||e.setVolume(s).play()}function r(t,e,n,i){var s,i={mode:(i=void 0===i?!0:i)?2:1,volume:{start:e.volume,end:0},duration:n};e.hasOwnProperty("_fade")?(s=e._fade).stop().resetFromJSON(i):(s=new Rt(t,e,i),e._fade=s),s.start(),e.isPlaying||e.play()}function K(t){return t>>16&255}function X(t){return t>>8&255}function Y(t){return 255&t}function Z(e,n){var i,s,r;e.hasOwnProperty("tintR")||(i=K(n=void 0===n?16777215:n),s=X(n),r=Y(n),Object.defineProperty(e,"tint",{get:function(){return n},set:function(t){t=16777215&Math.floor(t),e.setTint(t),n!==t&&(i=K(n=t),s=X(n),r=Y(n))}}),Object.defineProperty(e,"tintR",{get:function(){return i},set:function(t){t=255&Math.floor(t),i!==t&&(i=t,e.tint=(255&t)<<16|n&Bt)}}),Object.defineProperty(e,"tintG",{get:function(){return s},set:function(t){t=255&Math.floor(t),s!==t&&(s=t,e.tint=(255&t)<<8|n&Lt)}}),Object.defineProperty(e,"tintB",{get:function(){return r},set:function(t){t=255&Math.floor(t),r!==t&&(r=t,e.tint=255&t|n&Vt)}}),Object.defineProperty(e,"tintGray",{get:function(){return Math.floor((i+s+r)/3)},set:function(t){t=255&Math.floor(t),i===t&&s===t&&r===t||(r=s=i=t,e.tint=(255&t)<<16|(255&t)<<8|255&t)}}),e.tint=n)}function q(t,e,n,i,s){var r,a,o,u,c,h,l;function f(){s(t,e,n,i)}t.hasOwnProperty("vp")||(void 0===n&&(n=.5),void 0===i&&(i=.5),void 0===s&&(s=H),(r=e).events||(a=new Dt,o=r.x,Object.defineProperty(r,"x",{get:function(){return o},set:function(t){o!==t&&(o=t,a.emit("update",r))}}),u=r.y,Object.defineProperty(r,"y",{get:function(){return u},set:function(t){u!==t&&(u=t,a.emit("update",r))}}),c=r.width,Object.defineProperty(r,"width",{get:function(){return c},set:function(t){c!==t&&(c=t,a.emit("update",r))}}),h=r.height,Object.defineProperty(r,"height",{get:function(){return h},set:function(t){h!==t&&(h=t,a.emit("update",r))}}),r.events=a),l=e.events,t.vp=e,l.on("update",f),t.once("destroy",function(){l.off("update",f),t.vp=void 0}),Object.defineProperty(t,"vpx",{get:function(){return n},set:function(t){n!==t&&(n=t,f())}}),Object.defineProperty(t,"vpy",{get:function(){return i},set:function(t){i!==t&&(i=t,f())}}),f())}function H(t,e,n,i){t.x=e.x+e.width*n,t.y=e.y+e.height*i}function Q(t){return t=Xt(t)?F:$t(t)?j:_}function m(t,e,n,i,s){return function(){t.emit(G,s),e.apply(i,n)}}var t={setEventEmitter:function(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter:function(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter:function(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},tt=/[|\\{}()[\]^$+*?.]/g,et=/-/g,nt=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,it=function(){function e(t){h(this,e),this.setEventEmitter(n(t,"eventEmitter",void 0)),this.setTagExpression(n(t,"regex.tag","[a-z0-9-_.]+")),this.setValueExpression(n(t,"regex.value","[ #a-z-_.0-9,|&]+")),this.setValueConverter(n(t,"valueConvert",!0));t=n(t,"delimiters","<>");this.setDelimiters(t[0],t[1]),this.isRunning=!1,this.isPaused=!1,this.skipEventFlag=!1,this.lastTagStart=null,this.lastTagEnd=null,this.lastContent=null}return o(e,[{key:"shutdown",value:function(){this.destroyEventEmitter()}},{key:"destroy",value:function(){this.shutdown()}},{key:"setTagExpression",value:function(t){return this.tagExpression=t,this}},{key:"setValueExpression",value:function(t){return this.valueExpression=t,this}},{key:"setValueConverter",value:function(t){return this.valueConverter=t=!0===t?V:t||D,this}},{key:"setDelimiters",value:function(t,e){void 0===e&&(e=t[1],t=t[0]),this.delimiterLeft=t,this.delimiterRight=e,t=s(t),e=s(e);var n="".concat(t,"(").concat(this.tagExpression,")(=(").concat(this.valueExpression,"))?").concat(e),t="".concat(t,"/(").concat(this.tagExpression,")").concat(e);return this.reTagOn=RegExp(n,"i"),this.reTagOff=RegExp(t,"i"),this.reSplit=RegExp("".concat(n,"|").concat(t),"gi"),this}},{key:"setSource",value:function(t){return this.source=t,this}},{key:"resetIndex",value:function(t){return this.progressIndex=t=void 0===t?0:t,this.reSplit.lastIndex=t,this.lastTagStart=null,this.lastTagEnd=null,this.lastContent=null,this}},{key:"start",value:function(t){return this.setSource(t).restart(),this}},{key:"restart",value:function(){this.resetIndex().next()}},{key:"next",value:function(){this.isPaused&&this.onResume(),0===this.reSplit.lastIndex&&this.onStart();for(var t=this.source,e=t.length;!this.isPaused;){var n=this.reSplit.exec(t);if(!n)return this.progressIndex<e&&this.onContent(t.substring(this.progressIndex,e)),void this.onComplete();var n=n[0],i=this.reSplit.lastIndex-n.length;this.progressIndex<i&&this.onContent(t.substring(this.progressIndex,i)),this.reTagOff.test(n)?this.onTagEnd(n):this.onTagStart(n),this.progressIndex=this.reSplit.lastIndex}}},{key:"skipEvent",value:function(){return this.skipEventFlag=!0,this}},{key:"pause",value:function(){return this.isPaused||this.onPause(),this}},{key:"onContent",value:function(t){this.skipEventFlag=!1,this.emit("content",t),this.lastContent=t}},{key:"onTagStart",value:function(t){var t=t.match(this.reTagOn),e=t[1],t=function(t,e){if(null==t)return[];for(var n=t.split(","),i=0,s=n.length;i<s;i++)n[i]=e(n[i]);return n}(t[3],this.valueConverter);this.skipEventFlag=!1,this.emit.apply(this,["+".concat(e)].concat(u(t))),this.skipEventFlag||this.emit.apply(this,["+",e].concat(u(t))),this.lastTagStart=e}},{key:"onTagEnd",value:function(t){t=t.match(this.reTagOff)[1];this.skipEventFlag=!1,this.emit("-".concat(t)),this.skipEventFlag||this.emit("-",t),this.lastTagEnd=t}},{key:"onStart",value:function(){this.isRunning=!0,this.emit("start",this)}},{key:"onComplete",value:function(){this.isRunning=!1,this.emit("complete",this),this.resetIndex()}},{key:"onPause",value:function(){this.isPaused=!0,this.emit("pause",this)}},{key:"onResume",value:function(){this.isPaused=!1,this.emit("resume",this)}},{key:"getTagOnRegString",value:function(t,e){return void 0===t&&(t=this.tagExpression),void 0===e&&(e=this.valueExpression),"".concat(s(this.delimiterLeft),"(").concat(t,")(=(").concat(e,"))?").concat(s(this.delimiterRight))}},{key:"getTagOffRegString",value:function(t){return void 0===t&&(t=this.tagExpression),"".concat(s(this.delimiterLeft),"/(").concat(t,")").concat(s(this.delimiterRight))}}]),e}(),a=(Object.assign(it.prototype,t),Phaser.Math.DegToRad),st={to:!0,yoyo:!0},rt={to:!0,yoyo:!0},at=[function(e,n,t){n.on("+".concat("wait"),function(t){e.wait(t),n.skipEvent()}).on("-".concat("wait"),function(){n.skipEvent()}).on("+".concat("click"),function(){e.wait("click"),n.skipEvent()}).on("-".concat("click"),function(){n.skipEvent()})},function(n,i,t){i.on("+".concat("se"),function(t,e){this.skipSoundEffect||(n.soundManager.playSoundEffect(t),e&&n.soundManager.fadeInSoundEffect(e),i.skipEvent())}).on("-".concat("se"),function(){i.skipEvent()})},function(e,n,t){var i="se.fadein";n.on("+".concat(i),function(t){e.soundManager.fadeInSoundEffect(t),n.skipEvent()}).on("-".concat(i),function(){n.skipEvent()})},function(n,i,t){var e="se.fadeout";i.on("+".concat(e),function(t,e){n.soundManager.fadeOutSoundEffect(t,e="stop"===e),i.skipEvent()}).on("-".concat(e),function(){i.skipEvent()})},function(e,n,t){var i="se.volume";n.on("+".concat(i),function(t){e.soundManager.setSoundEffectVolume(t),n.skipEvent()}).on("-".concat(i),function(){n.skipEvent()})},function(n,i,t){i.on("+".concat("bgm"),function(t,e){n.soundManager.playBackgroundMusic(t),e&&n.soundManager.fadeInBackgroundMusic(e),i.skipEvent()}).on("-".concat("bgm"),function(){n.soundManager.stopBackgroundMusic(),i.skipEvent()})},function(e,n,t){var i="bgm.fadein";n.on("+".concat(i),function(t){e.soundManager.fadeInBackgroundMusic(t),n.skipEvent()}).on("-".concat(i),function(){n.skipEvent()})},function(n,i,t){var e="bgm.fadeout";i.on("+".concat(e),function(t,e){n.soundManager.fadeOutBackgroundMusic(t,e="stop"===e),i.skipEvent()}).on("-".concat(e),function(){i.skipEvent()})},function(n,i,t){var e="bgm.cross";i.on("+".concat(e),function(t,e){n.soundManager.crossFadeBackgroundMusic(t,e),i.skipEvent()}).on("-".concat(e),function(){i.skipEvent()})},function(t,e,n){var i="bgm.pause";e.on("+".concat(i),function(){t.soundManager.pauseBackgroundMusic(),e.skipEvent()}).on("-".concat(i),function(){t.soundManager.resumeBackgroundMusic(),e.skipEvent()})},function(s,r,t){r.on("+".concat("camera.fadein"),function(t,e,n,i){s.camera.fadeIn(t,e,n,i),r.skipEvent()})},function(s,r,t){r.on("+".concat("camera.fadeout"),function(t,e,n,i){s.camera.fadeOut(t,e,n,i),r.skipEvent()})},function(n,i,t){i.on("+".concat("camera.shake"),function(t,e){n.camera.shake(t,e),i.skipEvent()})},function(s,r,t){r.on("+".concat("camera.flash"),function(t,e,n,i){s.camera.flash(t,e,n,i),r.skipEvent()})},function(i,s,t){var e="camera.zoom";s.on("+".concat(e),function(t){i.camera.setZoom(t),s.skipEvent()}).on("+".concat(e,".to"),function(t,e,n){i.camera.zoomTo(t,e,n),s.skipEvent()})},function(i,s,t){var e="camera.rotate";s.on("+".concat(e),function(t){i.camera.setRotation(a(t)),s.skipEvent()}).on("+".concat(e,".to"),function(t,e,n){t=a(t),i.camera.rotateTo(a(t),!1,e,n),s.skipEvent()})},function(o,u,t){var e="camera.scroll";u.on("+".concat(e),function(t,e){o.camera.setScroll(t,e),u.skipEvent()}).on("+".concat(e,".to"),function(t,e,n,i){var s=o.camera,r=s.scrollX,a=s.scrollY;s.setScroll(t,e),t+=s.centerX,e+=s.centerY,s.setScroll(r,a),s.pan(t,e,n,i),u.skipEvent()})},function(a,o,t){o.on("+",function(t){var e;if(!o.skipEventFlag){var n=t.split(".");if(N(n,"sprite")){for(var n=n[1],i=arguments.length,s=new Array(1<i?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];(e=a.spriteManager).add.apply(e,[n].concat(s)),o.skipEvent()}}}).on("-",function(t){o.skipEventFlag||(t=t.split("."),N(t,"sprite")&&(t=t[1],a.spriteManager.remove(t),o.skipEvent()))})},function(e,n,t){n.on("-",function(t){n.skipEventFlag||"sprite"===t&&(e.spriteManager.removeAll(),n.skipEvent())})},function(r,a,t){a.on("+",function(t,e,n){var i,s;a.skipEventFlag||(t=t.split("."),s="sprite",3===(i=t).length&&i[0]===s&&"texture"===i[2]&&(s=t[1],r.spriteManager.setTexture(s,e,n),a.skipEvent()))})},function(s,r,t){var a="sprite";r.on("+",function(t){var e,n,i;r.skipEventFlag||(e=t.split("."),U(e,a)&&(e=e[1],i=(n=Array.prototype.slice.call(arguments,1)).shift(),s.spriteManager.playAnimation(e,i),0<n.length&&s.spriteManager.chainAnimation(e,n),r.skipEvent()))}).on("+",function(t){var e,n;r.skipEventFlag||(t=t.split("."),n=a,3===(e=t).length&&e[0]===n&&"stop"===e[2]&&(n=t[1],s.spriteManager.stopAnimation(n),r.skipEvent()))}).on("-",function(t){r.skipEventFlag||(t=t.split("."),U(t,a)&&(t=t[1],s.spriteManager.stopAnimation(t),r.skipEvent()))})},function(s,r,t){r.on("+",function(t){var e,n,i;r.skipEventFlag||(e=t.split("."),n="sprite",3===(i=e).length&&i[0]===n&&"chain"===i[2]&&(n=e[1],i=Array.prototype.slice.call(arguments,1),s.spriteManager.chainAnimation(n,i),r.skipEvent()))})},function(i,s,t){s.on("+",function(t){var e,n;s.skipEventFlag||(t=t.split("."),n="sprite",3===(e=t).length&&e[0]===n&&"pause"===e[2]&&(n=t[1],i.spriteManager.pauseAnimation(n),s.skipEvent()))})},function(s,r,t){r.on("+",function(t,e){var n,i;r.skipEventFlag||(t=t.split("."),i="sprite",3===(n=t).length&&n[0]===i&&(n=t[1],i=t[2],s.spriteManager.setProperty(n,i,e),r.skipEvent()))})},function(o,u,t){u.on("+",function(t,e,n,i,s){var r,a;u.skipEventFlag||(t=t.split("."),r="sprite",4===(a=t).length&&a[0]===r&&st[a[3]]&&(r=t[1],a=t[2],t="yoyo"===t[3],"number"==typeof i&&(s=i,i=void 0),o.spriteManager.easeProperty(r,a,e,n,i,s,t),u.skipEvent()))})},function(a,o,t){o.on("+",function(t){var e;if(!o.skipEventFlag){var n=t.split(".");if(W(n,"text")){for(var n=n[1],i=arguments.length,s=new Array(1<i?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];(e=a.textManager).add.apply(e,[n].concat(s)),o.skipEvent()}}}).on("-",function(t){o.skipEventFlag||(t=t.split("."),W(t,"text")&&(t=t[1],a.textManager.remove(t),o.skipEvent()))})},function(e,n,t){n.on("-",function(t){n.skipEventFlag||"text"===t&&(e.textManager.removeAll(),n.skipEvent())})},function(n,i,t){i.on("+",function(t){i.skipEventFlag||(t=t.split("."),J(t,"text")&&(t[1],i.skipEvent()))}).on("content",function(t){var e;i.skipEventFlag||"\n"!==t&&(e=i.lastTagStart.split("."),J(e,"text")&&(e=e[1],t=t.replaceAll("\\n","\n"),n.textManager.setText(e,t),i.skipEvent()))})},function(n,i,t){i.on("+",function(t,e){i.skipEventFlag||(t=t.split("."),z(t,"text")&&(t=t[1],void 0!==e&&n.textManager.setTypingSpeed(t,e),i.skipEvent()))}).on("content",function(t){var e;i.skipEventFlag||"\n"!==t&&(e=i.lastTagStart.split("."),z(e,"text")&&(e=e[1],t=t.replaceAll("\\n","\n"),n.textManager.typingText(e,t),i.skipEvent()))})},function(s,r,t){r.on("+",function(t,e){var n,i;r.skipEventFlag||(t=t.split("."),i="text",3===(n=t).length&&n[0]===i&&(n=t[1],i=t[2],s.textManager.setProperty(n,i,e),r.skipEvent()))})},function(o,u,t){u.on("+",function(t,e,n,i,s){var r,a;u.skipEventFlag||(t=t.split("."),r="text",4===(a=t).length&&a[0]===r&&rt[a[3]]&&(r=t[1],a=t[2],t="yoyo"===t[3],"number"==typeof i&&(s=i,i=void 0),o.textManager.easeProperty(r,a,e,n,i,s,t),u.skipEvent()))})},function(n,i,t){i.on("content",function(t){var e;i.skipEventFlag||"\n"!==t&&(e="+".concat(i.lastTagStart),n.emit("".concat(e,"#content"),i,t))})},function(r,a,t){a.on("+",function(t){if(!a.skipEventFlag){for(var e="+".concat(t),n=arguments.length,i=new Array(1<n?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];r.emit.apply(r,["".concat(e),a].concat(i))}}).on("-",function(t){a.skipEventFlag||(t="-".concat(t),r.emit("".concat(t),a))})}],ot=Phaser.Utils.Objects.GetValue,ut=function(){l(c,it);var u=d(c);function c(t,e){h(this,c),(e=void 0===e?{}:e).hasOwnProperty("delimiters")||(e.delimiters="[]"),n=u.call(this,e);for(var n,i=t,s=p(n),r=e,a=0,o=at.length;a<o;a++)at[a](i,s,r);return s.on("start",function(){i.emit("start",s)}).on("complete",function(){i.emit("complete",s)}),n.setCommentLineStartSymbol(ot(e,"comment","//")),n}return o(c,[{key:"setCommentLineStartSymbol",value:function(t){return this.commentLineStart=t,this}},{key:"start",value:function(t){return v(f(c.prototype),"start",this).call(this,function(t,e){for(var n=t.commentLineStart,i=e.split("\n"),s=0,r=i.length;s<r;s++){var a=i[s];""!==a&&(0===a.trim().length||n&&a.startsWith(n))&&(i[s]="")}return i.join("")}(this,t)),this}}]),c}(),ct=Phaser.Scene,c=function(t){return t instanceof ct},ht=Phaser.Utils.Objects.GetValue,e=function(){function n(t,e){h(this,n),this.parent=t,this.scene=null==(t=t)||"object"!==I(t)?null:c(t)?t:t.scene&&c(t.scene)?t.scene:t.parent&&t.parent.scene&&c(t.parent.scene)?t.parent.scene:void 0,this.isShutdown=!1,this.setEventEmitter(ht(e,"eventEmitter",!0)),this.parent&&this.parent===this.scene?this.scene.sys.events.once("shutdown",this.onSceneDestroy,this):this.parent&&this.parent.once&&this.parent.once("destroy",this.onParentDestroy,this)}return o(n,[{key:"shutdown",value:function(t){this.isShutdown||(this.parent&&this.parent===this.scene?this.scene.sys.events.off("shutdown",this.onSceneDestroy,this):this.parent&&this.parent.once&&this.parent.off("destroy",this.onParentDestroy,this),this.destroyEventEmitter(),this.parent=void 0,this.scene=void 0,this.isShutdown=!0)}},{key:"destroy",value:function(t){this.shutdown(t)}},{key:"onSceneDestroy",value:function(){this.destroy(!0)}},{key:"onParentDestroy",value:function(t,e){this.destroy(e)}}]),n}(),lt=(Object.assign(e.prototype,t),Phaser.Utils.Objects.GetValue),ft=function(){l(i,e);var n=d(i);function i(t,e){return h(this,i),(t=n.call(this,t,e))._isRunning=!1,t.isPaused=!1,t.tickingState=!1,t.setTickingMode(lt(e,"tickingMode",1)),t}return o(i,[{key:"boot",value:function(){2!==this.tickingMode||this.tickingState||this.startTicking()}},{key:"shutdown",value:function(t){this.isShutdown||(this.stop(),this.tickingState&&this.stopTicking(),v(f(i.prototype),"shutdown",this).call(this,t))}},{key:"setTickingMode",value:function(t){"string"==typeof t&&(t=pt[t]),this.tickingMode=t}},{key:"startTicking",value:function(){this.tickingState=!0}},{key:"stopTicking",value:function(){this.tickingState=!1}},{key:"isRunning",get:function(){return this._isRunning},set:function(t){this._isRunning!==t&&(this._isRunning=t,1===this.tickingMode&&t!=this.tickingState&&(t?this.startTicking():this.stopTicking()))}},{key:"start",value:function(){return this.isPaused=!1,this.isRunning=!0,this}},{key:"pause",value:function(){return this.isRunning&&(this.isPaused=!0,this.isRunning=!1),this}},{key:"resume",value:function(){return this.isPaused&&(this.isRunning=!0),this}},{key:"stop",value:function(){return this.isPaused=!1,this.isRunning=!1,this}},{key:"complete",value:function(){this.isPaused=!1,this.isRunning=!1,this.emit("complete",this.parent,this)}}]),i}(),pt={no:0,lazy:1,always:2},y=Phaser.Utils.Objects.GetValue,dt=function(){l(i,ft);var n=d(i);function i(t,e){return h(this,i),(t=n.call(this,t,e)).resetFromJSON(e),t.boot(),t}return o(i,[{key:"resetFromJSON",value:function(t){return this.isRunning=y(t,"isRunning",!1),this.timeScale=y(t,"timeScale",1),this.now=y(t,"now",0),this}},{key:"toJSON",value:function(){return{isRunning:this.isRunning,timeScale:this.timeScale,now:this.now,tickingMode:this.tickingMode}}},{key:"start",value:function(t){return void 0===t&&(t=0),this.delta=0,this.now=t,v(f(i.prototype),"start",this).call(this),this}},{key:"seek",value:function(t){return this.now=t,this}},{key:"setTimeScale",value:function(t){return this.timeScale=t,this}},{key:"tick",value:function(t){return t*=this.timeScale,this.now+=t,this.delta=t,this.emit("update",this.now,this.delta),this}}]),i}(),vt=function(){l(e,dt);var t=d(e);function e(){return h(this,e),t.apply(this,arguments)}return o(e,[{key:"startTicking",value:function(){v(f(e.prototype),"startTicking",this).call(this),this.scene.sys.events.on("update",this.update,this)}},{key:"stopTicking",value:function(){v(f(e.prototype),"stopTicking",this).call(this),this.scene&&this.scene.sys.events.off("update",this.update,this)}},{key:"update",value:function(t,e){return this.isRunning&&0!==this.timeScale&&this.tick(e),this}}]),e}(),mt=Phaser.Math.Clamp,yt=function(){function n(t,e){h(this,n),this.setTimeline(t).reset(e)}return o(n,[{key:"setTimeline",value:function(t){return this.timeline=t,this}},{key:"setName",value:function(t){return this.name=t,this}},{key:"setCallbacks",value:function(t,e,n,i){return this.target=t,this.onStart=e,this.onProgress=n,this.onComplete=i,this}},{key:"setDuration",value:function(t,e){return void 0===e&&(e=!1),this.duration=t,this.remainder=t,this.t=0,this.yoyo=e,this}},{key:"setPaused",value:function(t){return this.isPaused=t,this}},{key:"pause",value:function(){return this.isPaused=!0,this}},{key:"resume",value:function(){return this.isPaused=!1,this}},{key:"setRemoved",value:function(t){return this.removed=t,this}},{key:"remove",value:function(){return this.removed=!0,this}},{key:"seek",value:function(t){return this.remainder=this.duration*(1-t),this}},{key:"reset",value:function(t){return this.setName(t.name).setDuration(t.duration,t.yoyo).setCallbacks(t.target,t.onStart,t.onProgress,t.onComplete).setPaused(!1).setRemoved(!1),this}},{key:"onFree",value:function(){this.setTimeline().setCallbacks()}},{key:"getProgress",value:function(){var t,e,n=1-this.remainder/this.duration,n=mt(n,0,1);return this.yoyo&&((t=n)<=(e=void 0===e?.5:e)?t/=e:t=1-(t-e)/(1-e),n=t),n}},{key:"setProgress",value:function(t){t=mt(t,0,1),this.remainder=this.duration*(1-t)}},{key:"runCallback",value:function(t){t&&t(this.target,this.t,this)}},{key:"update",value:function(t,e){if(this.removed)return!0;if(this.isPaused)return!1;this.remainder-=e,this.t=this.getProgress(),this.runCallback(this.onProgress);e=this.remainder<=0;return e&&this.runCallback(this.onComplete),e}}]),n}(),gt=function(){function t(){h(this,t),this.items=[]}return o(t,[{key:"destroy",value:function(){this.clear(),this.items=void 0}},{key:"pop",value:function(){return 0<this.items.length?this.items.pop():null}},{key:"push",value:function(t){return this.items.push(t),this}},{key:"pushMultiple",value:function(t){return this.items.push.apply(this.items,t),t.length=0,this}},{key:"clear",value:function(){return this.items.length=0,this}}]),t}(),g=function(){l(e,gt);var t=d(e);function e(){return h(this,e),t.apply(this,arguments)}return o(e,[{key:"allocate",value:function(){return this.pop()}},{key:"free",value:function(t){t.onFree(),this.push(t)}},{key:"freeMultiple",value:function(t){for(var e=0,n=t.length;e<n;e++)this.free(t[e]);return this}}]),e}(),kt=Phaser.Utils.Objects.GetValue,bt=new g,Et=function(){l(a,vt);var n=d(a);function a(t,e){return h(this,a),(t=n.call(this,t,e)).addedTimers=[],t.timers=[],t.timerPool=kt(e,"pool",bt),t}return o(a,[{key:"shutdown",value:function(){this.isShutdown||(this.timerPool.freeMultiple(this.addedTimers).freeMultiple(this.timers),this.timerPool=void 0,this.addedTimers=void 0,this.timers=void 0,v(f(a.prototype),"shutdown",this).call(this))}},{key:"addTimer",value:function(t){var e=this.timerPool.allocate();return e?e.setTimeline(this).reset(t):e=new yt(this,t),this.addedTimers.push(e),e.runCallback(e.onStart),this.isRunning||this.start(),e}},{key:"delayCall",value:function(t,i,s,r){return this.addTimer({duration:t,onComplete:function(t,e,n){(s=void 0===s?[]:s).push(n),i.apply(r,s)}})}},{key:"getTimers",value:function(t){for(var e=[],n=[this.addedTimers,this.timers],i=0,s=n.length;i<s;i++)for(var r=n[i],a=0,o=r.length;a<o;a++){var u=r[a];u.name===t&&e.push(u)}return e}},{key:"update",value:function(t,e){v(f(a.prototype),"update",this).call(this,t,e),(t=this.timers).push.apply(t,u(this.addedTimers));for(var n=[],i=this.addedTimers.length=0,s=this.timers.length;i<s;i++){var r=this.timers[i];r.update(this.now,this.delta)?this.timerPool.free(r):n.push(r)}this.timers=n,0===this.timers.length&&0===this.addedTimers.length&&this.complete()}}]),a}(),Tt=Phaser.Utils.Objects.GetValue,wt=function(){l(i,ft);var n=d(i);function i(t,e){return h(this,i),(t=n.call(this,t,e)).tickEventName=Tt(e,"tickEventName","update"),t}return o(i,[{key:"startTicking",value:function(){v(f(i.prototype),"startTicking",this).call(this),this.scene.sys.events.on(this.tickEventName,this.update,this)}},{key:"stopTicking",value:function(){v(f(i.prototype),"stopTicking",this).call(this),this.scene&&this.scene.sys.events.off(this.tickEventName,this.update,this)}}]),i}(),k=Phaser.Utils.Objects.GetValue,Mt=Phaser.Math.Clamp,xt=function(){function e(t){h(this,e),this.resetFromJSON(t)}return o(e,[{key:"resetFromJSON",value:function(t){this.state=k(t,"state",b),this.timeScale=k(t,"timeScale",1),this.delay=k(t,"delay",0),this.repeat=k(t,"repeat",0),this.repeatCounter=k(t,"repeatCounter",0),this.duration=k(t,"duration",0),this.nowTime=k(t,"nowTime",0),this.justRestart=k(t,"justRestart",!1)}},{key:"toJSON",value:function(){return{state:this.state,timeScale:this.timeScale,delay:this.delay,repeat:this.repeat,repeatCounter:this.repeatCounter,duration:this.duration,nowTime:this.nowTime,justRestart:this.justRestart}}},{key:"destroy",value:function(){}},{key:"setTimeScale",value:function(t){return this.timeScale=t,this}},{key:"setDelay",value:function(t){return this.delay=t=void 0===t?0:t,this}},{key:"setDuration",value:function(t){return this.duration=t,this}},{key:"setRepeat",value:function(t){return this.repeat=t,this}},{key:"setRepeatInfinity",value:function(){return this.repeat=-1,this}},{key:"start",value:function(){return this.nowTime=0<this.delay?-this.delay:0,this.state=0<=this.nowTime?T:E,this.repeatCounter=0,this}},{key:"stop",value:function(){return this.state=b,this}},{key:"update",value:function(t,e){this.state!==b&&this.state!==w&&0!==e&&0!==this.timeScale&&(this.nowTime+=e*this.timeScale,this.state=0<=this.nowTime?T:E,this.justRestart=!1,this.nowTime>=this.duration&&(-1===this.repeat||this.repeatCounter<this.repeat?(this.repeatCounter++,this.justRestart=!0,this.nowTime-=this.duration):(this.nowTime=this.duration,this.state=w)))}},{key:"t",get:function(){var t;switch(this.state){case b:case E:t=0;break;case T:t=this.nowTime/this.duration;break;case w:t=1}return Mt(t,0,1)},set:function(t){(t=Mt(t,-1,1))<0?(this.state=E,this.nowTime=-this.delay*t):(this.state=T,this.nowTime=this.duration*t,1===t&&0!==this.repeat&&this.repeatCounter++)}},{key:"setT",value:function(t){return this.t=t,this}},{key:"isIdle",get:function(){return this.state===b}},{key:"isDelay",get:function(){return this.state===E}},{key:"isCountDown",get:function(){return this.state===T}},{key:"isRunning",get:function(){return this.state===E||this.state===T}},{key:"isDone",get:function(){return this.state===w}},{key:"isOddIteration",get:function(){return 1==(1&this.repeatCounter)}},{key:"isEvenIteration",get:function(){return 0==(1&this.repeatCounter)}}]),e}(),b=0,E=1,T=2,w=-1,St=function(){l(i,wt);var n=d(i);function i(t,e){return h(this,i),(t=n.call(this,t,e)).timer=new xt,t}return o(i,[{key:"shutdown",value:function(t){this.isShutdown||(v(f(i.prototype),"shutdown",this).call(this,t),this.timer.destroy(),this.timer=void 0)}},{key:"start",value:function(){return this.timer.start(),v(f(i.prototype),"start",this).call(this),this}},{key:"stop",value:function(){return this.timer.stop(),v(f(i.prototype),"stop",this).call(this),this}},{key:"complete",value:function(){return this.timer.stop(),v(f(i.prototype),"complete",this).call(this),this}}]),i}(),M=Phaser.Utils.Objects.GetValue,Ot=Phaser.Utils.Objects.GetAdvancedValue,Pt=Phaser.Tweens.Builders.GetEaseFunction,Ct=function(){l(e,St);var t=d(e);function e(){return h(this,e),t.apply(this,arguments)}return o(e,[{key:"resetFromJSON",value:function(t){return this.timer.resetFromJSON(M(t,"timer")),this.setEnable(M(t,"enable",!0)),this.setTarget(M(t,"target",this.parent)),this.setDelay(Ot(t,"delay",0)),this.setDuration(Ot(t,"duration",1e3)),this.setEase(M(t,"ease","Linear")),this.setRepeat(M(t,"repeat",0)),this}},{key:"setEnable",value:function(t){return this.enable=t=null==t?!0:t,this}},{key:"setTarget",value:function(t){return void 0===t&&(t=this.parent),this.target=t,this}},{key:"setDelay",value:function(t){return this.delay=t,this}},{key:"setDuration",value:function(t){return this.duration=t,this}},{key:"setEase",value:function(t){return this.ease=t=void 0===t?"Linear":t,this.easeFn=Pt(t),this}},{key:"setRepeat",value:function(t){return this.repeat=t,this}},{key:"start",value:function(){return this.timer.isRunning||v(f(e.prototype),"start",this).call(this),this}},{key:"restart",value:function(){return this.timer.stop(),this.start.apply(this,arguments),this}},{key:"stop",value:function(t){return void 0===t&&(t=!1),v(f(e.prototype),"stop",this).call(this),t&&(this.timer.setT(1),this.updateGameObject(this.target,this.timer),this.complete()),this}},{key:"update",value:function(t,e){var n,i;return this.isRunning&&this.enable&&this.parent.active&&(n=this.target,(i=this.timer).update(t,e),i.isDelay||this.updateGameObject(n,i),this.emit("update",n,this),i.isDone&&this.complete()),this}},{key:"updateGameObject",value:function(t,e){}}]),e}(),jt=Phaser.Utils.Objects.GetValue,_t=Phaser.Utils.Objects.GetAdvancedValue,Ft=Phaser.Math.Linear,Rt=function(){l(s,Ct);var i=d(s);function s(t,e,n){return h(this,s),e.scene=t,e.active=!0,(t=i.call(this,e,n)).volume={},t.resetFromJSON(n),t}return o(s,[{key:"resetFromJSON",value:function(t){return v(f(s.prototype),"resetFromJSON",this).call(this,t),this.setMode(jt(t,"mode",0)),this.setEnable(jt(t,"enable",!0)),this.setVolumeRange(_t(t,"volume.start",this.parent.volume),_t(t,"volume.end",0)),this}},{key:"setMode",value:function(t){return"string"==typeof t&&(t=Gt[t]),this.mode=t,this}},{key:"setVolumeRange",value:function(t,e){return this.volume.start=t,this.volume.end=e,this}},{key:"start",value:function(){return this.timer.isRunning||(this.parent.setVolume(this.volume.start),this.timer.setDelay(this.delay).setDuration(this.duration),v(f(s.prototype),"start",this).call(this)),this}},{key:"updateGameObject",value:function(t,e){t.volume=Ft(this.volume.start,this.volume.end,e.t)}},{key:"complete",value:function(){switch(v(f(s.prototype),"complete",this).call(this),this.mode){case 1:this.parent.stop();break;case 2:this.parent.destroy()}return this}}]),s}(),Gt={stop:1,destroy:2},x=Phaser.Utils.Objects.GetValue,At=Phaser.Utils.Array.Remove,It=function(){function n(t,e){h(this,n),this.scene=t,this.soundEffects=[],this.backgroundMusic=void 0,this.setBackgroundMusicLoopValue(x(e,"bgm.loop",!0)),this.setBackgroundMusicFadeTime(x(e,"bgm.fade",500));t=x(e,"bgm.initial",void 0);t&&this.setCurrentBackgroundMusic(t)}return o(n,[{key:"destroy",value:function(t){if(this.soundEffects.length&&!t)for(var e=this.soundEffects.length-1;0<=e;e--)this.soundEffects[e].destroy();this.soundEffects.length=0,this.backgroundMusic&&!t&&this.backgroundMusic.destroy(),this.backgroundMusic=void 0,this.scene=void 0}},{key:"setBackgroundMusicLoopValue",value:function(t){return this.backgroundMusicLoopValue=t,this}},{key:"setBackgroundMusicFadeTime",value:function(t){return this.backgroundMusicFadeTime=t,this}},{key:"getSoundEffects",value:function(){return this.soundEffects}},{key:"getLastSoundEffect",value:function(){return this.soundEffects[this.soundEffects.length-1]}},{key:"getBackgroundMusic",value:function(){return this.backgroundMusic}},{key:"playSoundEffect",value:function(t){var e=this.scene.sys.sound.add(t);return this.soundEffects.push(e),e.once("complete",function(){e.destroy(),this.scene&&At(this.soundEffects,e)},this).once("destroy",function(){this.scene&&At(this.soundEffects,e)},this).play(),this}},{key:"setSoundEffectVolume",value:function(t){var e=this.getLastSoundEffect();return e&&e.setVolume(t),this}},{key:"fadeInSoundEffect",value:function(t){var e=this.getLastSoundEffect();return e&&$(this.scene,e,t),this}},{key:"fadeOutSoundEffect",value:function(t,e){var n=this.getLastSoundEffect();return n&&r(this.scene,n,t,e),this}},{key:"fadeOutAllSoundEffects",value:function(t,e){for(var n=this.soundEffects.length-1;0<=n;n--)r(this.scene,this.soundEffects[n],t,e);return this}},{key:"setCurrentBackgroundMusic",value:function(t){(this.backgroundMusic=t)&&(t.setLoop(this.backgroundMusicLoopValue),t.once("complete",function(){this.backgroundMusic.destroy(),this.backgroundMusic=void 0},this).once("destroy",function(){this.backgroundMusic=void 0},this),t.isPlaying||t.play())}},{key:"playBackgroundMusic",value:function(t){return this.backgroundMusic&&this.backgroundMusic.key===t||(this.stopBackgroundMusic(),this.setCurrentBackgroundMusic(this.scene.sys.sound.add(t)),0<this.backgroundMusicFadeTime&&this.fadeInBackgroundMusic(this.backgroundMusicFadeTime)),this}},{key:"pauseBackgroundMusic",value:function(){return this.backgroundMusic&&this.backgroundMusic.pause(),this}},{key:"resumeBackgroundMusic",value:function(){return this.backgroundMusic&&this.backgroundMusic.resume(),this}},{key:"stopBackgroundMusic",value:function(){return this.backgroundMusic&&(0<this.backgroundMusicFadeTime?this.fadeOutBackgroundMusic(this.backgroundMusicFadeTime,!0):(this.backgroundMusic.stop(),this.backgroundMusic.destroy(),this.backgroundMusic=void 0)),this}},{key:"fadeInBackgroundMusic",value:function(t){return this.backgroundMusic&&$(this.scene,this.backgroundMusic,t),this}},{key:"fadeOutBackgroundMusic",value:function(t,e){return this.backgroundMusic&&r(this.scene,this.backgroundMusic,t,e),this}},{key:"crossFadeBackgroundMusic",value:function(t,e){var n=this.backgroundMusicFadeTime;return this.backgroundMusicFadeTime=0,this.fadeOutBackgroundMusic(e,!0).playBackgroundMusic(t).fadeInBackgroundMusic(e),this.backgroundMusicFadeTime=n,this}}]),n}(),S=function(){function i(t,e,n){h(this,i),this.GOManager=t,this.tweens={},this.setGO(e,n)}return o(i,[{key:"scene",get:function(){return this.GOManager.scene}},{key:"timeScale",get:function(){return this.GOManager.timeScale}},{key:"destroy",value:function(){this.freeGO(),this.GOManager=void 0}},{key:"freeTweens",value:function(){var t,e=this.tweens;for(t in e)e[t].remove(),delete e[t];return this}},{key:"freeGO",value:function(){return this.freeTweens(),this.gameObject.destroy(),this.gameObject=void 0,this}},{key:"setGO",value:function(t,e){return this.gameObject=t.setName(e),this.name=e,this.freeTweens(),this}},{key:"setProperty",value:function(t,e){return this.gameObject[t]=e,this}},{key:"easeProperty",value:function(t,e,n,i,s,r,a){var o=this.tweens,u=(o.hasOwnProperty(t)&&o[t].remove(),this.gameObject),n={targets:u,duration:n,ease:i,repeat:s,yoyo:r,onComplete:function(){o[t].remove(),delete o[t],a&&a(u,t)},onCompleteScope:this},i=(n[t]=e,this.scene.tweens.add(n));return i.timeScale=this.timeScale,o[t]=i,this}},{key:"setTimeScale",value:function(t){var e,n=this.tweens;for(e in n)n[e].timeScale=t;return this}}]),i}(),Bt=65535,Lt=16711935,Vt=16776960,Dt=Phaser.Events.EventEmitter,Nt=Phaser.Utils.Array.Remove,g={},O=(Object.assign(g,{has:function(t){return this.bobs.hasOwnProperty(t)},get:function(t){return this.bobs[t]},getGO:function(t){return this.get(t).gameObject},add:function(t){this.remove(t);for(var e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var s=this.createGameObjectCallback.apply(this,[this.scene].concat(n)),r=!!s.setTint&&0<this.fadeTime,a=!!s.setAlpha&&0<this.fadeTime,o=(r&&Z(s),this.viewportCoordinateEnable&&q(s),s.once("destroy",function(){Nt(this.removedGOs,s),this.isEmpty&&this.emit("empty")},this),new this.BobClass(this,s,t));return this.bobs[t]=o,r?o.setProperty("tintGray",0).easeProperty("tintGray",255,this.fadeTime):a&&o.setProperty("alpha",0).easeProperty("alpha",1,this.fadeTime),this}},{remove:function(t){var e,n;return this.has(t)&&(e=this.get(t),delete this.bobs[t],this.removedGOs.push(e.gameObject),t=!!e.gameObject.setTint&&0<this.fadeTime,n=!!gameObject.setAlpha&&0<this.fadeTime,t?e.easeProperty("tintGray",0,this.fadeTime,"Linear",0,!1,function(){e.destroy()}):n?e.easeProperty("alpha",0,this.fadeTime,"Linear",0,!1,function(){e.destroy()}):e.destroy()),this},removeAll:function(){for(var t in this.bobs)this.remove(t);return this},clear:function(t){void 0===t&&(t=!0);var e,n=this.bobs;for(e in n)t&&n[e].destroy(),delete n[e];return this.removedGOs.length=0,this}},{setProperty:function(t,e,n){return this.has(t)&&this.get(t).setProperty(e,n),this},easeProperty:function(t,e,n,i,s,r,a,o){return this.has(t)&&(void 0===i&&(i=1e3),void 0===s&&(s="Linear"),void 0===r&&(r=0),void 0===a&&(a=!1),this.get(t).easeProperty(e,n,i,s,r,a,o)),this},getTweenTask:function(t,e){if(this.has(t)){t=this.get(t).tweens;if(t.hasOwnProperty(e))return t[e]}return null}}),Phaser.Utils.Objects.GetValue),P=function(){function n(t,e){h(this,n),this.scene=t,this.BobClass=O(e,"BobClass",S),this.setCreateGameObjectCallback(O(e,"createGameObject")),this.setEventEmitter(O(e,"eventEmitter",void 0)),this.setGOFadeTime(O(e,"fade",500)),this.setViewportCoordinateEnable(O(e,"viewportCoordinate",!1)),this.bobs={},this.removedGOs=[],this._timeScale=1}return o(n,[{key:"destroy",value:function(t){this.clear(!t),this.createGameObjectCallback=void 0,this.scene=void 0}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){if(this._timeScale!==t){this._timeScale=t;var e,n=this.bobs;for(e in n)n[e].setTimeScale(t)}}},{key:"setTimeScale",value:function(t){return this.timeScale=t,this}},{key:"setCreateGameObjectCallback",value:function(t){return this.createGameObjectCallback=t,this}},{key:"setGOFadeTime",value:function(t){return this.fadeTime=t,this}},{key:"setViewportCoordinateEnable",value:function(t){return this.viewportCoordinateEnable=t=void 0===t?!0:t,this}},{key:"isEmpty",get:function(){return function(t){for(var e in t)return!1;return!0}(this.bobs)&&0===this.removedGOs.length}}]),n}(),Ut=(Object.assign(P.prototype,t,g),function(){l(e,S);var t=d(e);function e(){return h(this,e),t.apply(this,arguments)}return o(e,[{key:"setTexture",value:function(t,e){return this.gameObject.setTexture(t,e),this}},{key:"playAnimation",value:function(t){return this.gameObject.anims.timeScale=this.timeScale,this.gameObject.play(t),this}},{key:"stopAnimation",value:function(){return this.gameObject.stop(),this}},{key:"chainAnimation",value:function(t){return this.gameObject.chain(t),this}},{key:"pauseAnimation",value:function(){return this.gameObject.anims.pause(),this}},{key:"setTimeScale",value:function(t){return v(f(e.prototype),"setTimeScale",this).call(this,t),this.gameObject.anims&&(this.gameObject.anims.timeScale=t),this}}]),e}()),t={},C=(Object.assign(t,{playAnimation:function(t,e){return this.has(t)||this.add(t),this.get(t).playAnimation(e),this},stopAnimation:function(t){return this.has(t)&&this.get(t).stopAnimation(),this},chainAnimation:function(t,e){return this.has(t)&&this.get(t).chainAnimation(e),this},pauseAnimation:function(t){return this.has(t)&&this.get(t).pauseAnimation(),this},setTexture:function(t,e,n){return this.has(t)&&this.get(t).setTexture(e,n),this}}),function(){l(i,P);var n=d(i);function i(t,e){return h(this,i),(e=void 0===e?{}:e).BobClass=Ut,n.call(this,t,e)}return o(i,[{key:"setCreateGameObjectCallback",value:function(t){return t&&"sprite"!==t?"image"===t&&(t=Jt):t=Wt,v(f(i.prototype),"setCreateGameObjectCallback",this).call(this,t),this}}]),i}()),Wt=function(t,e,n){return t.add.sprite(0,0,e,n)},Jt=function(t,e,n){return t.add.image(0,0,e,n)},zt=(Object.assign(C.prototype,t),Phaser.GameObjects.Text),$t=function(t){return t instanceof zt},Kt=Phaser.GameObjects.BitmapText,Xt=function(t){return t instanceof Kt},j=0,_=1,F=2,R=Phaser.Utils.Objects.GetFastValue,Yt=Phaser.Utils.Objects.GetValue,Zt=function(){l(i,e);var n=d(i);function i(t,e){return h(this,i),(t=n.call(this,t,e)).timer=null,t.resetFromJSON(e),t}return o(i,[{key:"resetFromJSON",value:function(t){this.setTextWrapEnable(Yt(t,"wrap",!1)),this.setTypeMode(Yt(t,"typeMode",0)),this.setTypeSpeed(Yt(t,"speed",333)),this.setTextCallback=R(t,"setTextCallback",null),this.setTextCallbackScope=R(t,"setTextCallbackScope",null),this.setTypingContent(R(t,"text","")),this.typingIdx=R(t,"typingIdx",0),this.insertIdx=R(t,"insertIdx",null);t=R(t,"elapsed",null);return null!==t&&this.start(void 0,void 0,this.typingIdx,t),this}},{key:"shutdown",value:function(t){this.isShutdown||(this.freeTimer(),v(f(i.prototype),"shutdown",this).call(this,t))}},{key:"setTypeMode",value:function(t){return"string"==typeof t&&(t=Ht[t]),this.typeMode=t,this}},{key:"setTypeSpeed",value:function(t){return this.speed=t,this}},{key:"setTextWrapEnable",value:function(t){return this.textWrapEnable=t=void 0===t?!0:t,this}},{key:"text",get:function(){return this._text},set:function(t){t=qt(t);this.textWrapEnable&&(t=function(t,e){switch(Q(t)){case j:t.style.syncFont(t.canvas,t.context),e=t.runWordWrap(e);break;case _:e=t.getText(e,void 0,void 0,!0);break;case F:e=t.setText(e).getTextBounds().wrappedText}return e}(this.parent,t)),this._text=t}},{key:"isTyping",get:function(){return null!==this.getTimer()}},{key:"isLastChar",get:function(){return this.typingIdx===this.textLen}},{key:"start",value:function(t,e,n,i){return void 0!==t&&this.setTypingContent(t),void 0!==e&&(this.speed=e),this.typingIdx=(n=void 0===n?0:n)+1,0===this.speed?this.stop(!0):(this.setText(""),this.startTimer(i)),this}},{key:"appendText",value:function(t){t=this.text.concat(qt(t));return this.isTyping?this.setTypingContent(t):this.start(t,void 0,this.textLen),this}},{key:"stop",value:function(t){return this.getTimer()&&this.freeTimer(),t&&(this.typingIdx=this.textLen,this.setText(this.text),this.emit("type"),this.emit("complete",this,this.parent)),this}},{key:"pause",value:function(){var t=this.getTimer();return t&&(t.paused=!0),this}},{key:"resume",value:function(){var t=this.getTimer();return t&&(t.paused=!1),this}},{key:"setTypingContent",value:function(t){return this.text=t,this.textLen=this.getTextLength(this.text),this}},{key:"onTyping",value:function(){var t=this.getTypingString(this.text,this.typingIdx,this.textLen,this.typeMode);this.setText(t),this.emit("type"),this.isLastChar?(this.freeTimer(),this.emit("complete",this,this.parent)):(this.timer.delay=this.speed,this.typingIdx++)}},{key:"getTypingString",value:function(t,e,n,i){var s,r,a,o;return 0===i?(a=0,this.insertIdx=o=e,s=this.getSubString(t,a,o)):1===i?(a=(o=n)-e,this.insertIdx=0,s=this.getSubString(t,a,o)):2===i?(o=(a=Math.floor(n/2-e/2))+e,this.insertIdx=e%2?e:0,s=this.getSubString(t,a,o)):3===i&&(n=0<(i=Math.floor(e/2))?(a=(o=n)-i,this.getSubString(t,a,o)):"",0<(e=e-i)?(o=(a=0)+e,this.insertIdx=o,r=this.getSubString(t,a,o)):(r="",this.insertIdx=0),s=r+n),s}},{key:"startTimer",value:function(t){return this.timer&&this.freeTimer(),t=void 0===t?0:(this.speed,t),this.timer=this.scene.time.addEvent({delay:0,startAt:t,loop:!0,callback:this.onTyping,callbackScope:this}),this}},{key:"getTimer",value:function(){return this.timer}},{key:"freeTimer",value:function(){return this.timer&&(this.timer.remove(),this.timer=null),this}},{key:"setText",value:function(t){if(this.setTextCallback&&(t=this.setTextCallbackScope?this.setTextCallback.call(this.setTextCallbackScope,t,this.isLastChar,this.insertIdx):this.setTextCallback(t,this.isLastChar,this.insertIdx)),this.textWrapEnable){var e=this.parent,n=t;switch(Q(e)){case j:var i=(r=e.style).wordWrapWidth,s=r.wordWrapCallback;r.wordWrapWidth=0,r.wordWrapCallback=void 0,e.setText(n),r.wordWrapWidth=i,r.wordWrapCallback=s;break;case _:var r,i=(r=e.style).wrapMode;r.wrapMode=0,e.setText(n),r.wrapMode=i;break;case F:s=e._maxWidth;e._maxWidth=0,e.setText(n),e._maxWidth=s}}else this.parent.setText(t)}},{key:"getTextLength",value:function(t){var e=this.parent,e=(e.getPlainText?e.getPlainText(t):t).length;return e}},{key:"getSubString",value:function(t,e,n){var i=this.parent,i=i.getSubString?i.getSubString(t,e,n):t.slice(e,n);return i}}]),i}(),qt=function(t){return Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t},Ht={"left-to-right":0,"right-to-left":1,"middle-to-sides":2,"sides-to-middle":3},Qt=function(){l(e,S);var t=d(e);function e(){return h(this,e),t.apply(this,arguments)}return o(e,[{key:"setText",value:function(t){return this.gameObject.setText(t),this}},{key:"setTypingSpeed",value:function(t){var e=this.gameObject;return e.typing||(e.typing=new Zt(e)),e.typing.setTypeSpeed(t),this}},{key:"typing",value:function(t,e){var n=this.gameObject;return n.typing||(n.typing=new Zt(n)),n.typing.start(t,e),this}},{key:"getTypingTask",value:function(){var t=this.gameObject.typing;return t&&t.isTyping?t:null}}]),e}(),g={},te=(Object.assign(g,{setText:function(t,e){return this.has(t)||this.add(t),this.get(t).setText(e),this},typingText:function(t,e){return this.has(t)||this.add(t),this.get(t).typing(e),this},setTypingSpeed:function(t,e){return this.get(t).setTypingSpeed(e),this},getTypingTask:function(t){return this.has(t)?this.get(t).getTypingTask():null}}),function(){l(i,P);var n=d(i);function i(t,e){return h(this,i),(e=void 0===e?{}:e).BobClass=Qt,n.call(this,t,e)}return o(i,[{key:"setCreateGameObjectCallback",value:function(t){return t&&"text"!==t||(t=ee),v(f(i.prototype),"setCreateGameObjectCallback",this).call(this,t),this}}]),i}()),ee=function(t){return t.add.text(0,0,"")},ne=(Object.assign(te.prototype,g),function(n,i){return new Promise(function(t,e){n.once(i,function(){t()})})}),G="_remove.wait",ie=[G,"_remove.play"],se=function(t,e,n,i,s){n=m(t,n,i,s,"custom"),i=e?"wait.".concat(e):"wait";t.emit(i,n)},re=function(t,e,n,i,s){var r,a,o,n=m(t,n,i,s,"time");t.once(G,function(){r&&(r.remove(),r=void 0)}),r=t.timeline.delayCall(e,n,a,o),t.emit("wait.time",e)},ae=function(t,e,n,i){var s,r=t.clickEE;r&&(s=m(t,e,n,i,"click"),t.once(G,function(){r.off("pointerdown",s,t)}),r.once("pointerdown",s,t),t.emit("wait.click"))},oe=function(t,e,n,i,s){var r=m(t,n,i,s,"music");e&&(t.once(G,function(){e.off("complete",r,t)}),e.once("complete",r,t)),t.emit("wait.music",e),e||r()},ue=function(t){switch(t){case"camera.fadein":case"camera.fadeout":case"camera.flash":case"camera.shake":case"camera.zoom":case"camera.rotate":case"camera.scroll":return!0;default:return!1}},ce=function(e,t,n,i,s){var r,a,o=m(e,n,i,s,"camera.".concat(t)),u=e.camera;switch(t){case"camera.fadein":r=u.fadeEffect,a="camerafadeincomplete";break;case"camera.fadeout":r=u.fadeEffect,a="camerafadeoutcomplete";break;case"camera.flash":r=u.flashEffect,a="cameraflashcomplete";break;case"camera.shake":r=u.shakeEffect,a="camerashakecomplete";break;case"camera.zoom":r=u.zoomEffect,a="camerazoomcomplete";break;case"camera.rotate":r=u.rotateToEffect,a="camerarotatecomplete";break;case"camera.scroll":r=u.panEffect,a="camerapancomplete"}r.isRunning?(e.once(G,function(t){u.off(a,o,e)}),u.once(a,o,e),e.emit("wait.camera",t)):(e.emit("wait.camera",t),o())},he=function(t,e,n,i,s){var r=m(t,n,i,s,"keydown"),a="keydown-".concat(e.toUpperCase()),o=t.scene.input.keyboard;t.once(G,function(){o.off(a,r,t)}),o.once(a,r,t),t.emit("wait.keydown",e)},le=function(t){t=t.split(".");return"sprite"===t[0]&&t.length<=3},fe=function(e,t,n,i,s){var r=m(e,n,i,s),a=t.split("."),o=e.spriteManager;switch(a.length){case 1:o.isEmpty?(e.emit("wait.sprite"),r()):(e.once(G,function(t){o.off("empty",r,e)}),o.once("empty",r,e),e.emit("wait.sprite"));break;case 2:var u,c=a[1];o.has(c)?(u=e.spriteManager.get(c).sprite,e.once(G,function(){u.off("destroy",r,e)}),u.once("destroy",r,e),e.emit("wait.sprite",c)):(e.emit("wait.sprite",c),r());break;case 3:var c=a[1],h=a[2],l=e.spriteManager.getTweenTask(c,h);l?(e.once(G,function(){l.off("complete",r,e)}),l.once("complete",r,e),e.emit("wait.sprite",c,h)):(e.emit("wait.sprite",c,h),r())}},pe=function(t){t=t.split(".");return"text"===t[0]&&t.length<=3},de=function(e,t,n,i,s){var r=m(e,n,i,s),a=t.split("."),o=e.textManager;switch(a.length){case 1:o.isEmpty?(e.emit("wait.text"),r()):(e.once(G,function(t){o.off("empty",r,e)}),o.once("empty",r,e),e.emit("wait.text"));break;case 2:var u,c=a[1];o.has(c)?(u=e.textManager.get(c).text,e.once(G,function(){u.off("destroy",r,e)}),u.once("destroy",r,e),e.emit("wait.text",c)):(e.emit("wait.text",c),r());break;case 3:var c=a[1],h=a[2],l="typing"===h?e.textManager.getTypingTask(c):e.textManager.getTweenTask(c,h);l?(e.once(G,function(){l.off("complete",r,e)}),l.once("complete",r,e),e.emit("wait.text",c,h)):(e.emit("wait.text",c,h),r())}},ve=Phaser.Input.Keyboard.KeyCodes,t={setClickTarget:function(t){return(this.clickTarget=t)?c(t)?this.clickEE=t.input:this.clickEE=t.setInteractive():this.clickEE=null,this},setTargetCamera:function(t){return this.camera=t,this},setSkipSoundEffect:function(t){return(this.skipSoundEffect=t=void 0===t?!0:t)&&(t=this._soundManager)&&t.fadeOutAllSoundEffects(100,!0),this},play:function(t){return this.parser.start(t),this},playPromise:function(t){var e=ne(this,"complete");return this.play(t),e},pause:function(){return this.parser.pause(),this},resume:function(){return this.parser.next(),this},wait:function(t){if(!this.ignoreWait){this.pause();for(var e=this,n=t,i=this.resume,s=[],r=this,a=0,o=(n="string"==typeof n&&1<n.length&&-1!==n.indexOf("|")?n.split("|"):[n]).length;a<o;a++){var u,c=n[a];null==c||"wait"===c?se(e,void 0,i,s,r):"number"!=typeof c&&isNaN(c)?"click"===c?ae(e,i,s,r):"se"===c?(u=e.soundManager.getLastSoundEffect(),oe(e,u,i,s,r)):"bgm"===c?(u=e.soundManager.getBackgroundMusic(),oe(e,u,i,s,r)):(ve.hasOwnProperty(c.toUpperCase())?he:ue(c)?ce:le(c)?fe:pe(c)?de:se)(e,c,i,s,r):re(e,parseFloat(c),i,s,r)}}return this}},me=Phaser.Events.EventEmitter,A=Phaser.Utils.Objects.GetValue,ye=function(){l(r,me);var s=d(r);function r(t,e){h(this,r),(n=s.call(this)).scene=t,n.parser=new ut(p(n),A(e,"parser",void 0)),n.timeline=new Et(p(n)),n._soundManager=void 0;var n,i=A(e,"sounds",void 0),i=(i&&(n._soundManager=new It(n.scene,i)),n.setTargetCamera(A(e,"camera",n.scene.sys.cameras.main)),n._spriteManager=void 0,A(e,"sprites",void 0)),i=(i&&(n._spriteManager=new C(n.scene,i)),n._textManager=void 0,A(e,"texts",void 0));return i&&(n._textManager=new te(n.scene,i)),n.setClickTarget(A(e,"clickTarget",t)),n}return o(r,[{key:"isPlaying",get:function(){return this.parser.isRunning}},{key:"soundManager",get:function(){return void 0===this._soundManager&&(this._soundManager=new It(this.scene)),this._soundManager}},{key:"spriteManager",get:function(){return void 0===this._spriteManager&&(this._spriteManager=new C(this.scene)),this._spriteManager}},{key:"textManager",get:function(){return void 0===this._textManager&&(this._textManager=new te(this.scene)),this._textManager}},{key:"destroy",value:function(t){if(this.scene){for(var e=this,n=0,i=ie.length;n<i;n++)e.emit(ie[n]);this._soundManager&&this._soundManager.destroy(t),this._soundManager=void 0,this.camera=void 0,this._spriteManager&&this._spriteManager.destroy(t),this._spriteManager=void 0,this.scene=void 0}}}]),r}();return Object.assign(ye.prototype,t),function(){l(n,Phaser.Plugins.BasePlugin);var e=d(n);function n(t){return h(this,n),e.call(this,t)}return o(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"add",value:function(t,e){return new ye(t,e)}}]),n}()});
