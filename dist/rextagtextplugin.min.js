!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rextagtextplugin=e()}(void 0,function(){function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,n){e&&I(t.prototype,e),n&&I(t,n),Object.defineProperty(t,"prototype",{writable:!1})}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&B(t,e)}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function B(t,e){return(B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function e(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=r(n),e=(t=i?(t=r(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}}function j(){return(j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}(t,e);if(i)return i=Object.getOwnPropertyDescriptor(i,e),i.get?i.get.call(arguments.length<3?t:n):i.value}).apply(this,arguments)}function H(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function X(t){var e=y.create(this),n=e.getContext("2d");if(t.syncFont(e,n),"actualBoundingBoxAscent"in(s=n.measureText(t.testString)))return a={ascent:a=s.actualBoundingBoxAscent,descent:i=s.actualBoundingBoxDescent,fontSize:a+i},y.remove(e),a;var i=Math.ceil(s.width*t.baselineX),s=2*i,r=i*t.baselineY|0,a=(e.width=i,e.height=s,n.fillStyle="#f00",n.fillRect(0,0,i,s),n.font=t._font,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(t.testString,0,r),{ascent:0,descent:0,fontSize:0});if(!n.getImageData(0,0,i,s))return a.ascent=r,a.descent=6+r,a.fontSize=a.ascent+a.descent,y.remove(e),a;for(var o,l=n.getImageData(0,0,i,s).data,t=l.length,h=4*i,u=0,c=!1,d=0;d<r;d++){for(o=0;o<h;o+=4)if(255!==l[u+o]){c=!0;break}if(c)break;u+=h}for(a.ascent=r-d,u=t-h,c=!1,d=s;r<d;d--){for(o=0;o<h;o+=4)if(255!==l[u+o]){c=!0;break}if(c)break;u-=h}return a.descent=d-r,a.fontSize=a.ascent+a.descent,y.remove(e),a}function h(t,e,n){if(null==t)return t;switch(u(t)){case"string":return t;case"number":return"#".concat(q(Math.floor(t).toString(16),6,"0",1));case"function":return t(e,n);case"object":return t.hasOwnProperty("r")?t.hasOwnProperty("a")?"rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")"):"rgb(".concat(t.r,",").concat(t.g,",").concat(t.b,")"):t.hasOwnProperty("h")?t.hasOwnProperty("a")?"hsla(".concat(t.h,",").concat(t.s,",").concat(t.l,",").concat(t.a,")"):"hsl(".concat(t.h,",").concat(t.s,",").concat(t.l,")"):t;default:return t}}function f(t,e,n,i,s,r,a,o){if(null==o)t.ellipse(e,n,i,s,0,r,a);else for(var l,h,u=(a-r)/(o+=1),c=0;c<=o;c++)h=r+u*c,l=e+i*Math.cos(h),h=n+s*Math.sin(h),t.lineTo(l,h)}function Y(t,e,n,i,s,r,a,o){var l,h,u,c;null==e&&null==n||(c=t.canvas.width,l=t.canvas.height,u=(i=null==n?0:i)/2,c-=i,t.canvas,t=t.context,e=e,n=n,r=r,a=a,ot(t,h=u,u,u=c,i=l-=c=i,s,o),null!=e&&(null!=r&&((h=a?t.createLinearGradient(0,0,u,0):t.createLinearGradient(0,0,0,i)).addColorStop(0,e),h.addColorStop(1,r),e=h),t.fillStyle=e,t.fill()),null!=n&&0<c&&(t.strokeStyle=n,t.lineWidth=c,t.stroke()))}function O(t,e){var n=Array.isArray(t);if(void 0===e)e=n?[]:{};else{var i=e;if("object"===u(i)&&null!==i)if(Array.isArray(i))i.length=0;else for(var s in i)delete i[s]}if(n){e.length=t.length;for(var r=0,a=t.length;r<a;r++)e[r]=t[r]}else for(var o in t)e[o]=t[o];return e}function G(){}function D(t,e,n,i){var s=this.hitAreaManager.getFirst(e,n);null!==s&&F.call(this,"areadown",s.key,t,e,n,i)}function U(t,e,n,i){var s=this.hitAreaManager.getFirst(e,n);null!==s&&F.call(this,"areaup",s.key,t,e,n,i)}function n(t,e,n,i){if(null===e)return null!==this.lastHitAreaKey&&F.call(this,"areaout",this.lastHitAreaKey,t,e,n,i),void(this.lastHitAreaKey=null);var s=(s=this.hitAreaManager.getFirst(e,n))?s.key:null;this.lastHitAreaKey!==s&&(null!==this.lastHitAreaKey&&F.call(this,"areaout",this.lastHitAreaKey,t,e,n,i),null!==s&&F.call(this,"areaover",s,t,e,n,i),this.lastHitAreaKey=s)}function M(t,e,n){var i=L.pop();return(i=null===i?{}:i).text=t,i.width=e,i.newLineMode=n,i}function V(t,e,n,i,s){i<=0&&(n=mt);var r=[];if(t&&t.length)for(var a,o,l=n===mt,h=n===Tt,u=t.split(bt),c=0,d=u.length;c<d;c++)if(a=u[c],o=c===d-1?xt:wt,l){var f=e(a);r.push(M(a,f,o))}else{var y,p,g,v=0===c?i-s:i;if(a.length<=100)if((f=e(a))<=v){r.push(M(a,f,o));continue}h?(p=""===(y=a.split(" "))[y.length-1])&&--y.length:y=a;for(var k="",x=0,w=h?e(" "):void 0,m=0,T=y.length;m<T;m++){var S,b=e(g=y[m]),P=m===T-1;!h||P&&!p||(g+=" ",b+=w),h&&i<b?(""!==k?r.push(M(k,x,R)):0===m&&0<s&&r.push(M("",0,R)),r.push.apply(r,H(V(g,e,St,i,0))),k=(S=r.pop()).text,x=S.width,(S=S)&&L.push(S)," "===k&&(k="",x=0)):(v<(S=x+b)?(r.push(M(k,x,R)),k=g,x=b,v=i):(k+=g,x=S),P&&r.push(M(k,x,o)))}}return r}function a(t,e){(e=void 0===e?{key:t}:e).hasOwnProperty("key")||(e.key=t);var n,i,s=e.key,r=e.frame,a=e.width,o=e.height;void 0!==a&&void 0!==o||(n=(i=this.textureManager.getFrame(s,r))?i.cutWidth:0,i=i?i.cutHeight:0,void 0===a&&void 0===o?(a=n,o=i):void 0===a?a=n*(o/i):void 0===o&&(o=i*(a/n))),this.images[t]={key:s,frame:r,width:a,height:o,y:Ct(e,"y",0),left:Ct(e,"left",0),right:Ct(e,"right",0)}}var N=Phaser.Renderer.WebGL.Utils,J={renderWebGL:function(t,e,n,i){var s,r,a,o,l,h;0!==e.width&&0!==e.height&&(n.addToRenderList(e),r=(s=e.frame).width,a=s.height,o=N.getTintAppendFloatAlpha,h=(l=t.pipelines.set(e.pipeline,e)).setTexture2D(s.glTexture,e),t.pipelines.preBatch(e),l.batchTexture(e,s.glTexture,r,a,e.x,e.y,r/e.style.resolution,a/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,r,a,o(e.tintTopLeft,n.alpha*e._alphaTL),o(e.tintTopRight,n.alpha*e._alphaTR),o(e.tintBottomLeft,n.alpha*e._alphaBL),o(e.tintBottomRight,n.alpha*e._alphaBR),e.tintFill,0,0,n,i,!1,h),t.pipelines.postBatch(e))},renderCanvas:function(t,e,n,i){0!==e.width&&0!==e.height&&(n.addToRenderList(e),t.batchSprite(e,e.frame,n,i))}},y=Phaser.Display.Canvas.CanvasPool,o=0,l=1,K=2,p=0,E=1,g=2,$=/(?:\r\n|\r|\n)/,q=Phaser.Utils.String.Pad,Q=Phaser.Utils.Objects.GetAdvancedValue,v=Phaser.Utils.Objects.GetValue,k={backgroundColor:["backgroundColor",null,h],backgroundColor2:["backgroundColor2",null,h],backgroundHorizontalGradient:["backgroundHorizontalGradient",!0,null],backgroundStrokeColor:["backgroundStrokeColor",null,h],backgroundStrokeLineWidth:["backgroundStrokeLineWidth",2,null],backgroundCornerRadius:["backgroundCornerRadius",0,null],backgroundCornerIteration:["backgroundCornerIteration",null,null],fontFamily:["fontFamily","Courier",null],fontSize:["fontSize","16px",null],fontStyle:["fontStyle","",null],color:["color","#fff",h],stroke:["stroke","#fff",h],strokeThickness:["strokeThickness",0,null],shadowOffsetX:["shadow.offsetX",0,null],shadowOffsetY:["shadow.offsetY",0,null],shadowColor:["shadow.color","#000",h],shadowBlur:["shadow.blur",0,null],shadowStroke:["shadow.stroke",!1,null],shadowFill:["shadow.fill",!1,null],underlineColor:["underline.color","#000",h],underlineThickness:["underline.thickness",0,null],underlineOffset:["underline.offset",0,null],halign:["halign","left",null],valign:["valign","top",null],maxLines:["maxLines",0,null],fixedWidth:["fixedWidth",0,null],fixedHeight:["fixedHeight",0,null],resolution:["resolution",0,null],lineSpacing:["lineSpacing",0,null],xOffset:["xOffset",0,null],rtl:["rtl",!1,null],testString:["testString","|MÃ‰qgy",null],baselineX:["baselineX",1.2,null],baselineY:["baselineY",1.4,null],wrapMode:["wrap.mode",0,null],wrapWidth:["wrap.width",0,null],wrapCallback:["wrap.callback",null],wrapCallbackScope:["wrap.callbackScope",null]},Z=function(){function n(t,e){c(this,n),this.parent=t,this.backgroundColor,this.backgroundColor2,this.backgroundHorizontalGradient,this.backgroundStrokeColor,this.backgroundStrokeLineWidth,this.backgroundCornerRadius,this.backgroundCornerIteration,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.xOffset,this.rtl,this.testString,this.baselineX,this.baselineY,this.wrapMode,this.wrapWidth,this.wrapCallback,this.wrapCallbackScope,this._font,this.setStyle(e,!1,!0)}return s(n,[{key:"canvas",get:function(){return this.parent.canvasText.canvas}},{key:"context",get:function(){return this.parent.canvasText.context}},{key:"isWrapFitMode",get:function(){return 0<this.fixedWidth&&this.wrapMode!==p&&0===this.wrapWidth}},{key:"setStyle",value:function(t,e,n){for(var i in void 0===e&&(e=!0),void 0===n&&(n=!1),t&&t.hasOwnProperty("wrap")&&((l=t.wrap).hasOwnProperty("mode")?"string"==typeof(o=l.mode)&&(l.mode=tt[o]):l.hasOwnProperty("width")&&(l.mode=1)),t&&t.rtl&&n&&!t.hasOwnProperty("halign")&&(t.halign="right"),t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),k){var s=k[i],r=s[0],a=n?s[1]:this[i],s=s[2];"wrapCallback"===i||"wrapCallbackScope"===i?this[i]=v(t,r,a):(r=Q(t,r,a),s&&(r=s(r)),this[i]=r)}var o=v(t,"font",null),l=(this._font=null===o?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:o,v(t,"fill",null)),o=(null!==l&&(this.color=h(l)),v(t,"images",void 0)),l=(o&&this.parent.addImage(o),v(t,"metrics",!1));return l?this.metrics={ascent:v(l,"ascent",0),descent:v(l,"descent",0),fontSize:v(l,"fontSize",0)}:!e&&this.metrics||(this.metrics=X(this)),e?this.parent.updateText():this.parent}},{key:"syncFont",value:function(t,e){e.font=this._font}},{key:"syncStyle",value:function(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}},{key:"syncShadow",value:function(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}},{key:"update",value:function(t){return t&&(this._font="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim(),this.metrics=X(this)),this.parent.updateText(t)}},{key:"buildFont",value:function(){var t="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim();return t!==this._font&&(this._font=t),this}},{key:"setFont",value:function(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=v(t,"fontFamily","Courier"),this.fontSize=v(t,"fontSize","16px"),this.fontStyle=v(t,"fontStyle","")),this.update(!0)}},{key:"setFontFamily",value:function(t){return this.fontFamily=t,this.update(!0)}},{key:"setFontStyle",value:function(t){return this.fontStyle=t,this.update(!0)}},{key:"setFontSize",value:function(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}},{key:"setTestString",value:function(t){return this.testString=t,this.update(!0)}},{key:"setFixedSize",value:function(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(this.isWrapFitMode)}},{key:"setResolution",value:function(t){return this.resolution=t,this.update(!1)}},{key:"setLineSpacing",value:function(t){return this.lineSpacing=t,this.update(!1)}},{key:"setXOffset",value:function(t){return this.xOffset=t,this.update(!1)}},{key:"setBackgroundColor",value:function(t,e,n){return void 0===n&&(n=!0),this.backgroundColor=h(t,this.canvas,this.context),this.backgroundColor2=h(e,this.canvas,this.context),this.backgroundHorizontalGradient=n,this.update(!1)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.backgroundStrokeColor=h(t,this.canvas,this.context),this.backgroundStrokeLineWidth=e,this.update(!1)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.backgroundCornerRadius=t,this.backgroundCornerIteration=e,this.update(!1)}},{key:"setFill",value:function(t){return this.color=h(t,this.canvas,this.context),this.update(!1)}},{key:"setColor",value:function(t){return this.color=h(t,this.canvas,this.context),this.update(!1)}},{key:"setStroke",value:function(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=h(t,this.canvas,this.context),this.strokeThickness=e),this.update(!0)}},{key:"setShadow",value:function(t,e,n,i,s,r){return void 0===e&&(e=0),void 0===n&&(n="#000"),void 0===i&&(i=0),void 0===s&&(s=!1),void 0===r&&(r=!0),this.shadowOffsetX=t=void 0===t?0:t,this.shadowOffsetY=e,this.shadowColor=h(n,this.canvas,this.context),this.shadowBlur=i,this.shadowStroke=s,this.shadowFill=r,this.update(!1)}},{key:"setShadowOffset",value:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}},{key:"setShadowColor",value:function(t){return this.shadowColor=h(t=void 0===t?"#000":t,this.canvas,this.context),this.update(!1)}},{key:"setShadowBlur",value:function(t){return this.shadowBlur=t=void 0===t?0:t,this.update(!1)}},{key:"setShadowStroke",value:function(t){return this.shadowStroke=t,this.update(!1)}},{key:"setShadowFill",value:function(t){return this.shadowFill=t,this.update(!1)}},{key:"setUnderline",value:function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),this.underlineColor=h(t=void 0===t?"#000":t,this.canvas,this.context),this.underlineThickness=e,this.underlineOffset=n,this.update(!1)}},{key:"setUnderlineColor",value:function(t){return this.underlineColor=h(t=void 0===t?"#000":t,this.canvas,this.context),this.update(!1)}},{key:"setUnderlineThickness",value:function(t){return this.underlineThickness=t=void 0===t?0:t,this.update(!1)}},{key:"setUnderlineOffset",value:function(t){return this.underlineOffset=t=void 0===t?0:t,this.update(!1)}},{key:"setWrapMode",value:function(t){return"string"==typeof t&&(t=tt[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}},{key:"setWrapWidth",value:function(t){return this.wrapWidth=t,this.update(!1)}},{key:"setAlign",value:function(t,e){return void 0===e&&(e="top"),this.halign=t=void 0===t?"left":t,this.valign=e,this.update(!1)}},{key:"setHAlign",value:function(t){return this.halign=t=void 0===t?"left":t,this.update(!1)}},{key:"setVAlign",value:function(t){return this.valign=t=void 0===t?"top":t,this.update(!1)}},{key:"setMaxLines",value:function(t){return this.maxLines=t=void 0===t?0:t,this.update(!1)}},{key:"getTextMetrics",value:function(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}},{key:"setTextMetrics",value:function(t,e){return this.metrics.ascent=t.ascent,this.metrics.descent=t.descent,this.metrics.fontSize=t.fontSize,e&&("string"==typeof e?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=v(e,"fontFamily",this.fontFamily),this.fontSize=v(e,"fontSize",this.fontSize),this.fontStyle=v(e,"fontStyle",this.fontStyle))),this.parent.updateText(!0)}},{key:"lineHeight",get:function(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}},{key:"toJSON",value:function(){var t,e={};for(t in k)e[t]=this[t];return e.metrics=this.getTextMetrics(),e}},{key:"destroy",value:function(){this.parent=void 0}}]),n}(),tt={none:p,word:E,char:g,character:g},et=Phaser.Display.Canvas.CanvasPool,x=Phaser.Utils.Objects.GetValue,nt=function(){function r(t,e,n,i,s){c(this,r),this.cornerRadius={},this._width=0,this._height=0,this.setTo(t,e,n,i,s)}return s(r,[{key:"setTo",value:function(t,e,n,i,s){return this.setPosition(t,e),this.setRadius(s),this.setSize(n,i),this}},{key:"setPosition",value:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this}},{key:"setRadius",value:function(t){return this.radius=t=void 0===t?0:t,this}},{key:"setSize",value:function(t,e){return this.width=t,this.height=e,this}},{key:"minWidth",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}},{key:"minHeight",get:function(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}},{key:"width",get:function(){return this._width},set:function(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth)}},{key:"height",get:function(){return this._height},set:function(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight)}},{key:"radius",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)},set:function(t){var e,n="number"==typeof t?e=t:(e=x(t,"x",0),x(t,"y",0)),i=this.cornerRadius;i.tl=w(x(t,"tl",void 0),e,n),i.tr=w(x(t,"tr",void 0),e,n),i.bl=w(x(t,"bl",void 0),e,n),i.br=w(x(t,"br",void 0),e,n)}},{key:"radiusTL",get:function(){var t=this.cornerRadius.tl;return Math.max(t.x,t.y)},set:function(t){m(this.cornerRadius.tl,t)}},{key:"radiusTR",get:function(){var t=this.cornerRadius.tr;return Math.max(t.x,t.y)},set:function(t){m(this.cornerRadius.tr,t)}},{key:"radiusBL",get:function(){var t=this.cornerRadius.bl;return Math.max(t.x,t.y)},set:function(t){m(this.cornerRadius.bl,t)}},{key:"radiusBR",get:function(){var t=this.cornerRadius.br;return Math.max(t.x,t.y)},set:function(t){m(this.cornerRadius.br,t)}}]),r}(),w=function(t,e,n){return void 0===t?{x:e,y:n}:"number"==typeof t?{x:t,y:t}:t},m=function(t,e){"number"==typeof e?(t.x=e,t.y=e):(t.x=x(e,"x",0),t.y=x(e,"y",0))},T=Phaser.Math.DegToRad,it=T(0),st=T(90),rt=T(180),at=T(270),ot=function(t,e,n,i,s,r,a){var o,l,h,r=new nt(e,n,i,s,r),u=r.minWidth,c=r.minHeight,u=u<=i?1:i/u,c=c<=s?1:s/c,r=r.cornerRadius;t.save(),t.beginPath(),t.translate(e,n),n=(e=r.br).x*u,o=e.y*c,l=i-n,t.moveTo(i,h=s-o),0<n&&0<o?f(t,l,h,n,o,it,st,a):(t.lineTo(i,s),t.lineTo(l,s)),l=n=(e=r.bl).x*u,h=s-(o=e.y*c),t.lineTo(n,s),0<n&&0<o?f(t,l,h,n,o,st,rt,a):(t.lineTo(0,s),t.lineTo(0,h)),l=n=(e=r.tl).x*u,h=o=e.y*c,t.lineTo(0,h),0<n&&0<o?f(t,l,h,n,o,rt,at,a):(t.lineTo(0,0),t.lineTo(l,0)),n=(e=r.tr).x*u,h=o=e.y*c,t.lineTo(l=i-n,0),0<n&&0<o?f(t,l,h,n,o,at,it,a):(t.lineTo(i,0),t.lineTo(i,h)),t.closePath(),t.restore()},T={draw:function(t,e,n,i){var s,r,a,o=this.penManager,l=(this.hitAreaManager.clear(),this.context),h=(l.save(),this.defaultStyle),u=(this.clear(),Y(this,h.backgroundColor,h.backgroundStrokeColor,h.backgroundStrokeLineWidth,h.backgroundCornerRadius,h.backgroundColor2,h.backgroundHorizontalGradient,h.backgroundCornerIteration),t+=this.startXOffset,e+=this.startYOffset,h.halign),c=h.valign,d=h.lineHeight,f=o.lines,y=f.length,h=h.maxLines,h=0<h&&h<y?(r=h,"center"===c?Math.floor((y-r)/2):"bottom"===c?y-r:0):(r=y,0),p=h+r,g=this.rtl,v=g?this.parent.width:void 0,k="center"===c?Math.max((i-r*d)/2,0):"bottom"===c?Math.max(i-r*d-2,0):0;k+=e;for(var x=h;x<p;x++)if(0!==(s=o.getLineWidth(x))){for(var w=f[x],m=w.length,T=u,S=0;S<m;S++){var b=w[S].prop.align;if(void 0!==b){T=b;break}}a="center"===T?(n-s)/2:"right"===T?g?0:n-s:g?n-s:0,a+=t;for(S=0;S<m;S++)this.drawPen(w[S],a,k,v)}l.restore()},drawPen:function(t,e,n,i){e+=t.x,n+=t.y+(t.prop.y||0),void 0!==i&&(e=i-e);var i=this.canvas,s=this.context,r=(s.save(),this.parser.propToContextStyle(this.defaultStyle,t.prop));r.buildFont(),r.syncFont(i,s),r.syncStyle(i,s),0<r.underlineThickness&&0<t.width&&this.drawUnderline(e,n,t.width,r),t.isTextPen&&this.drawText(e,n,t.text,r),t.isImagePen&&this.drawImage(e,n,t.prop.img,r),s.restore(),t.hasAreaMarker&&0<t.width&&this.hitAreaManager.add(t.prop.area,e,n-this.startYOffset,t.width,this.defaultStyle.lineHeight)},clear:function(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawUnderline:function(t,e,n,i){e+=i.underlineOffset-i.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var s=this.context,r=s.lineCap;s.lineCap="butt",s.strokeStyle=i.underlineColor,s.lineWidth=i.underlineThickness,s.beginPath(),s.moveTo(t,e),s.lineTo(t+n,e),s.stroke(),s.lineCap=r},drawText:function(t,e,n,i){this.autoRound&&(t=Math.round(t),e=Math.round(e));var s=this.context;i.stroke&&"none"!==i.stroke&&0<i.strokeThickness&&(i.syncShadow(s,i.shadowStroke),s.strokeText(n,t,e)),i.color&&"none"!==i.color&&(i.syncShadow(s,i.shadowFill),s.fillText(n,t,e))},drawImage:function(t,e,n,i){e-=this.startYOffset,this.parent.imageManager.draw(n,this.context,t,e,this.autoRound)}},S=function(){function t(){c(this,t),this.items=[]}return s(t,[{key:"destroy",value:function(){this.clear(),this.items=void 0}},{key:"pop",value:function(){return 0<this.items.length?this.items.pop():null}},{key:"push",value:function(t){return this.items.push(t),this}},{key:"pushMultiple",value:function(t){return this.items.push.apply(this.items,t),t.length=0,this}},{key:"clear",value:function(){return this.items.length=0,this}}]),t}(),b=Phaser.Utils.Objects.GetValue,lt=o,ht=l,ut=function(){function e(t){c(this,e),this.prop={},this.resetFromJSON(t)}return s(e,[{key:"resetFromJSON",value:function(t){this.text=b(t,"text",""),this.x=b(t,"x",0),this.y=b(t,"y",0),this.width=b(t,"width",0);var e=b(t,"prop",null);this.prop=e=null===e?{}:e,this.newLineMode=b(t,"newLineMode",0),this.startIndex=b(t,"startIndex",0)}},{key:"plainText",get:function(){var t=this.text;return this.newLineMode===ht&&(t+="\n"),t}},{key:"wrapText",get:function(){var t=this.text;return this.newLineMode!==lt&&(t+="\n"),t}},{key:"rawTextLength",get:function(){var t=this.text.length;return this.newLineMode===ht&&(t+=1),t}},{key:"endIndex",get:function(){return this.startIndex+this.rawTextLength}},{key:"lastX",get:function(){return this.x+this.width}},{key:"isTextPen",get:function(){return""!==this.text}},{key:"isImagePen",get:function(){return!!this.prop.img}},{key:"hasAreaMarker",get:function(){return!!this.prop.area}}]),e}(),P=Phaser.Utils.Objects.GetFastValue,ct=o,dt=K,ft=new S,yt=new S,pt=function(){function o(t){c(this,o),this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=P(t,"pensPool",ft),this.LinesPool=P(t,"linesPool",yt),this.tagToText=P(t,"tagToText",G),this.tagToTextScope=P(t,"tagToTextScope",void 0)}return s(o,[{key:"destroy",value:function(){this.clear(),this.tagToText=void 0,this.tagToTextScope=void 0}},{key:"clear",value:function(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}},{key:"addTextPen",value:function(t,e,n,i,s,r){var a=this.PensPool.pop();return null==a&&(a=new ut),C.text=t,C.x=e,C.y=n,C.width=i,C.prop=s,C.newLineMode=r,a.resetFromJSON(C),this.addPen(a),this}},{key:"addImagePen",value:function(t,e,n,i){return this.addTextPen("",t,e,n,i,ct),this}},{key:"addNewLinePen",value:function(){var t=this.lastPen,e=t?t.lastX:0,n=t?t.y:0,t=t?O(t.prop):null;return this.addTextPen("",e,n,0,t,dt),this}},{key:"addPen",value:function(t){var e=this.lastPen,e=(t.startIndex=null==e?0:e.endIndex,this.pens.push(t),this.lastLine);null==e&&(e=this.LinesPool.pop()||[],this.lines.push(e)),e.push(t),t.newLineMode!==ct&&(e=this.LinesPool.pop()||[],this.lines.push(e)),this.maxLinesWidth=void 0}},{key:"clone",value:function(t){(t=null==t?new o:t).clear();for(var e=0,n=this.lines.length;e<n;e++)for(var i=this.lines[e],s=0,r=i.length;s<r;s++){var a=i[s];t.addPen(a.text,a.x,a.y,a.width,O(a.prop),a.newLineMode)}return t}},{key:"lastPen",get:function(){return this.pens[this.pens.length-1]}},{key:"lastLine",get:function(){return this.lines[this.lines.length-1]}},{key:"getLineStartIndex",value:function(t){return t>=this.lines.length?this.getLineEndIndex(t):(t=this.lines[t])&&t[0]?t[0].startIndex:0}},{key:"getLineEndIndex",value:function(t){for(var e,n=!1,i=t=t>=this.lines.length?this.lines.length-1:t;0<=i&&!(n=null!=(e=this.lines[i])&&0<e.length);i--);return n?e[e.length-1].endIndex:0}},{key:"getLineWidth",value:function(t){t=this.lines[t];if(!t)return 0;t=t[t.length-1];return null==t?0:t.lastX}},{key:"getMaxLineWidth",value:function(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,n=0,i=this.lines.length;n<i;n++)e<(t=this.getLineWidth(n))&&(e=t);return this.maxLinesWidth=e}},{key:"getLineWidths",value:function(){for(var t=[],e=0,n=this.lines.length;e<n;e++)t.push(this.getLineWidth(e));return t}},{key:"linesCount",get:function(){return this.lines.length}},{key:"plainText",get:function(){for(var t="",e=this.pens,n=0,i=e.length;n<i;n++)t+=e[n].plainText;return t}},{key:"rawTextLength",get:function(){for(var t=0,e=this.pens,n=0,i=this.pens.length;n<i;n++)t+=e[n].rawTextLength;return t}},{key:"getSliceTagText",value:function(t,e,n){if(void 0===t&&(t=0),void 0===e){var i=this.lastPen;if(null==i)return"";e=i.endIndex}void 0===n&&(n=!1);for(var s,r,a,o,l,h="",u=0,c=this.pens.length;u<c&&((a=this.pens[u].endIndex)<=t||(r=this.pens[u],s=n?r.wrapText:r.plainText,o=r.prop,t<=(r=r.startIndex)&&a<=e||(s=s.substring(t-r,e-r)),this.tagToTextScope?h+=this.tagToText.call(this.tagToTextScope,s,o,l):h+=this.tagToText(s,o,l),l=o,!(e<=a)));u++);return h}},{key:"length",get:function(){return this.lines.length},set:function(t){this.clear()}}]),o}(),C={},gt=Phaser.Geom.Rectangle,vt=new S,kt=function(){function t(){c(this,t),this.hitAreas=[]}return s(t,[{key:"destroy",value:function(){this.clear()}},{key:"clear",value:function(){return vt.pushMultiple(this.hitAreas),this}},{key:"add",value:function(t,e,n,i,s){var r=vt.pop();return null===r?r=new gt(e,n,i,s):r.setTo(e,n,i,s),r.key=t,this.hitAreas.push(r),this}},{key:"getFirst",value:function(t,e){for(var n=0,i=this.hitAreas.length;n<i;n++){var s=this.hitAreas[n];if(s.contains(t,e))return s}return null}},{key:"drawBounds",value:function(t,e,n){void 0===e&&(e=16777215),n&&t.save().scaleCanvas(n.scaleX,n.scaleY).rotateCanvas(n.rotation).translateCanvas(n.x,n.y);for(var i=0,s=this.hitAreas.length;i<s;i++){var r=this.hitAreas[i];t.lineStyle(1,e).strokeRect(r.x,r.y,r.width,r.height)}return n&&t.restore(),this}}]),t}(),F=function(t,e,n,i,s,r){this.parent.emit("".concat(t,"-").concat(e),n,i,s,r),this.parent.emit(t,e,n,i,s,r)},L=new S,xt=o,wt=l,R=K,mt=p,Tt=E,St=g,bt=$,W=Phaser.Utils.Objects.GetValue,Pt=p,Ot=o,Mt=function(){function n(t){c(this,n),this.parent=t.parent,this.context=W(t,"context",null),this.canvas=this.context.canvas,this.parser=W(t,"parser",null),this.defaultStyle=W(t,"style",null),this.autoRound=!0,this.pensPool=W(t,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new kt,this.lastHitAreaKey=null;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}return s(n,[{key:"destroy",value:function(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defaultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}},{key:"updatePenManager",value:function(t,e,n,i,s){if((s=void 0===s?this.penManager:s).clear(),""!==t){function r(t){return c.measureText(t).width}for(var a,o,l,h=this.parent.style,u=(h.isWrapFitMode&&(a=this.parent.padding,n=h.fixedWidth-a.left-a.right),this.canvas),c=this.context,d=0,f=0,y=h.wrapCallback,p=h.wrapCallbackScope,g=!0,v=this.parser.splitText(t),k=0,x=v.length;k<x;k++)if(o=(w=this.parser.tagTextToProp(v[k],l)).plainText,(l=w.prop).img){var w=this.imageManager.getOuterWidth(l.img);0<n&&e!==Pt&&n<d+w&&(s.addNewLinePen(),f+=i,d=0),s.addImagePen(d,f,w,O(l)),d+=w}else if(""!==o){if(c.save(),(w=this.parser.propToContextStyle(this.defaultStyle,l)).buildFont(),w.syncFont(u,c),w.syncStyle(u,c),y)for(var m,T=0,S=(m="string"==typeof(m=y.call(p,o,r,n,d))?m.split("\n"):m).length;T<S;T++)"string"==typeof(b=m[T])?m[T]=M(b,r(b),T<S-1?2:0):g=!1;else m=V(o,r,e,n,d);for(var b,T=0,S=m.length;T<S;T++)b=m[T],s.addTextPen(b.text,d,f,b.width,O(l),b.newLineMode),b.newLineMode!==Ot?(d=0,f+=i):d+=b.width;g&&(w=m)&&L.pushMultiple(w),m=null,c.restore()}for(k=0,x=this.lines.length;k<x;k++){var P=this.lines[k],P=P[P.length-1];P&&(P.width+=this.parser.getStrokeThinkness(this.defaultStyle,P.prop))}}return s}},{key:"startXOffset",get:function(){var t=this.defaultStyle;return t.strokeThickness/2+t.xOffset}},{key:"startYOffset",get:function(){var t=this.defaultStyle;return t.strokeThickness/2+t.metrics.ascent}},{key:"lines",get:function(){return this.penManager.lines}},{key:"desplayLinesCount",get:function(){var t=this.penManager.linesCount,e=this.defaultStyle.maxLines;return t=0<e&&e<t?e:t}},{key:"linesWidth",get:function(){return Math.ceil(this.penManager.getMaxLineWidth())}},{key:"linesHeight",get:function(){var t=this.desplayLinesCount,e=this.defaultStyle.lineHeight*t;return 0<t&&(e-=this.defaultStyle.lineSpacing),e}},{key:"imageManager",get:function(){return this.parent.imageManager}},{key:"rtl",get:function(){return this.parent.style.rtl}},{key:"newPenManager",value:function(){return new pt({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}},{key:"tmpPenManager",get:function(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}},{key:"getPlainText",value:function(t,e,n){if(null==t)s=this.penManager.plainText;else for(var i=this.parser.splitText(t,1),s="",r=0,a=i.length;r<a;r++)s+=i[r];return null==e&&null==n||(null==n&&(n=s.length),s=s.substring(e=null==e?0:e,n)),s}},{key:"getPenManager",value:function(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var n=this.defaultStyle;return this.updatePenManager(t,n.wrapMode,n.wrapWidth,n.lineHeight,e),e}},{key:"getText",value:function(t,e,n,i){if(null==t)return this.penManager.getSliceTagText(e,n,i);var s=this.tmpPenManager,r=this.defaultStyle;return this.updatePenManager(t,r.wrapMode,r.wrapWidth,r.lineHeight,s),s.getSliceTagText(e,n,i)}},{key:"copyPenManager",value:function(t,e){return(e=void 0===e?this.penManager:e).copy(t)}},{key:"getTextWidth",value:function(t){return(t=void 0===t?this.penManager:t).getMaxLineWidth()}},{key:"getLastPen",value:function(t){return(t=void 0===t?this.penManager:t).lastPen}}]),n}(),Ct=(Object.assign(Mt.prototype,T,{setInteractive:function(){this.parent.on("pointerdown",D,this).on("pointerup",U,this).on("pointermove",n,this).on("pointerover",n,this).on("pointerout",function(t,e){n.call(this,t,null,null,e)},this)}}),Phaser.Utils.Objects.GetValue),Ft=function(){function e(t){c(this,e),this.textureManager=t.sys.textures,this.images={}}return s(e,[{key:"destroy",value:function(){this.textureManager=void 0,this.images=void 0}},{key:"add",value:function(t,e){if("string"==typeof t)a.call(this,t,e);else if(Array.isArray(t))for(var n=0,i=(s=t).length;n<i;n++)a.call(this,s[n]);else{var s;for(t in s=t)a.call(this,t,s[t])}return this}},{key:"has",value:function(t){return this.images.hasOwnProperty(t)}},{key:"remove",value:function(t){return this.has(t)&&delete this.images[t],this}},{key:"get",value:function(t){return this.has(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}},{key:"getOuterWidth",value:function(t){t=this.get(t);return t?t.width+t.left+t.right:0}},{key:"getFrame",value:function(t){t=this.get(t);return t?this.textureManager.getFrame(t.key,t.frame):void 0}},{key:"hasTexture",value:function(t){return!!this.getFrame(t)}}]),e}(),Lt=(Object.assign(Ft.prototype,{draw:function(t,e,n,i,s){t=this.get(t),n+=t.left,i+=t.y,s&&(n=Math.round(n),i=Math.round(i)),s=this.textureManager.getFrame(t.key,t.frame);e.drawImage(s.source.image,s.cutX,s.cutY,s.cutWidth,s.cutHeight,n,i,t.width,t.height)}}),Phaser.Utils.Objects.IsPlainObject),Rt=Phaser.DOM.AddToDOM,Wt=Phaser.Display.Canvas.CanvasPool,At=Phaser.GameObjects.GameObject,A=Phaser.Utils.Objects.GetValue,zt=Phaser.DOM.RemoveFromDOM,_t=$,It={},Bt=function(){t(h,At);var l=e(h);function h(t,e,n,i,s,r,a){var o;return c(this,h),Lt(e)&&(e=A(o=e,"x",0),n=A(o,"y",0),i=A(o,"text",""),s=A(o,"style","")),void 0===e&&(e=0),void 0===n&&(n=0),(o=l.call(this,t,r)).renderer=t.sys.game.renderer,o.setPosition(e,n),o.setOrigin(0,0),o.initPipeline(),o.canvas=Wt.create(d(o)),o.context=o.canvas.getContext("2d"),o._imageManager=void 0,s&&(s.hasOwnProperty("align")&&(e=s.align,delete s.align,s.halign=e),s.hasOwnProperty("stroke")&&!s.hasOwnProperty("strokeThickness")&&(s.strokeThickness=1)),o.style=new Z(d(o),s),o.autoRound=!0,o._text=void 0,o.padding={left:0,right:0,top:0,bottom:0},o.width=1,o.height=1,o.dirty=!1,0===o.style.resolution&&(o.style.resolution=1),o._crop=o.resetCropObject(),o.texture=t.sys.textures.addCanvas(null,o.canvas,!0),o.frame=o.texture.get(),o.frame.source.resolution=o.style.resolution,o.renderer.gl&&(o.renderer.deleteTexture(o.frame.source.glTexture),o.frame.source.glTexture=null),It.hasOwnProperty(r)||(It[r]=new S),o.canvasText=new Mt({parent:d(o),context:o.context,parser:a,style:o.style,pensPool:It[r]}),o.parser=a,o.initRTL(),s&&s.padding&&o.setPadding(s.padding),o.setText(i),t.sys.game.events.on("contextrestored",o.onContextRestored,d(o)),o}return s(h,[{key:"onContextRestored",value:function(){this.dirty=!0}},{key:"preDestroy",value:function(){this.style.rtl&&zt(this.canvas),this.scene.sys.game.events.off("contextrestored",this.onContextRestored,this),this.canvasText.destroy(),this.canvasText=void 0,this._imageManager&&(this._imageManager.destroy(),this._imageManager=void 0),Wt.remove(this.canvas),this.texture.destroy()}},{key:"text",get:function(){return this._text},set:function(t){this.setText(t)}},{key:"initRTL",value:function(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",Rt(this.canvas,this.scene.sys.canvas),this.originX=1)}},{key:"setText",value:function(t){return(t=null==t?"":Array.isArray(t)?t.join("\n"):t.toString())!==this._text&&(this._text=t,this.updateText()),this}},{key:"appendText",value:function(t){return null!=t&&(Array.isArray(t)&&(t=t.join("\n")),this.setText(this.text+t.toString())),this}},{key:"setStyle",value:function(t){return this.style.setStyle(t)}},{key:"setFont",value:function(t){return this.style.setFont(t)}},{key:"setFontFamily",value:function(t){return this.style.setFontFamily(t)}},{key:"setFontSize",value:function(t){return this.style.setFontSize(t)}},{key:"setFontStyle",value:function(t){return this.style.setFontStyle(t)}},{key:"setTestString",value:function(t){return this.style.setTestString(t)}},{key:"setFixedSize",value:function(t,e){return this.style.setFixedSize(t,e)}},{key:"setBackgroundColor",value:function(t,e,n){return this.style.setBackgroundColor(t,e,n)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.style.setBackgroundStrokeColor(t,e)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.style.setBackgroundCornerRadius(t,e)}},{key:"setFill",value:function(t){return this.style.setFill(t)}},{key:"setColor",value:function(t){return this.style.setColor(t)}},{key:"setStroke",value:function(t,e){return this.style.setStroke(t,e)}},{key:"setShadow",value:function(t,e,n,i,s,r){return this.style.setShadow(t,e,n,i,s,r)}},{key:"setShadowOffset",value:function(t,e){return this.style.setShadowOffset(t,e)}},{key:"setShadowColor",value:function(t){return this.style.setShadowColor(t)}},{key:"setShadowBlur",value:function(t){return this.style.setShadowBlur(t)}},{key:"setShadowStroke",value:function(t){return this.style.setShadowStroke(t)}},{key:"setShadowFill",value:function(t){return this.style.setShadowFill(t)}},{key:"setWrapMode",value:function(t){return this.style.setWrapMode(t)}},{key:"setWrapWidth",value:function(t){return this.style.setWrapWidth(t)}},{key:"setWordWrapWidth",value:function(t){return this.style.setWrapWidth(t)}},{key:"setAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setHAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setVAlign",value:function(t){return this.style.setVAlign(t)}},{key:"setLineSpacing",value:function(t){return this.style.setLineSpacing(t)}},{key:"setXOffset",value:function(t){return this.style.setXOffset(t)}},{key:"setPadding",value:function(t,e,n,i){var s,r;return"object"===u(t)?(n=null!==(r=A(s=t,"x",null))?t=r:(t=A(s,"left",0),A(s,"right",t)),i=null!==(r=A(s,"y",null))?e=r:(e=A(s,"top",0),A(s,"bottom",e))):(void 0===t&&(t=0),void 0===e&&(e=t),void 0===n&&(n=t),void 0===i&&(i=e)),this.padding.left=t,this.padding.top=e,this.padding.right=n,this.padding.bottom=i,this.updateText(!1)}},{key:"setMaxLines",value:function(t){return this.style.setMaxLines(t)}},{key:"setResolution",value:function(t){return this.style.setResolution(t)}},{key:"updateText",value:function(t){var e,n,i=this.canvasText,s=this.style,t=((t=void 0===t?!0:t)&&i.updatePenManager(this._text,s.wrapMode,s.wrapWidth,s.lineHeight),this.padding),r=Math.ceil(i.linesWidth),r=(0===s.fixedWidth?(this.width=r+t.left+t.right,e=r):(this.width=s.fixedWidth,(e=this.width-t.left-t.right)<r&&(e=r)),0===s.fixedHeight?(this.height=i.linesHeight+t.top+t.bottom,n=i.linesHeight):(this.height=s.fixedHeight,(n=this.height-t.top-t.bottom)<i.linesHeight&&(n=i.linesHeight)),this.width),a=this.height,s=(this.updateDisplayOrigin(),s.resolution),o=(r*=s,a*=s,r=Math.max(Math.ceil(r),1),a=Math.max(Math.ceil(a),1),this.canvas),l=this.context,r=(o.width!==r||o.height!==a?(o.width=r,o.height=a,this.frame.setSize(r,a)):l.clearRect(0,0,r,a),l.save(),l.scale(s,s),this.style.rtl?t.right:t.left),a=t.top,s=(i.draw(r,a,e,n),l.restore(),this.renderer&&this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(o,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0,this.input);return s&&!s.customHitArea&&(s.hitArea.width=this.width,s.hitArea.height=this.height),this}},{key:"getTextMetrics",value:function(){return this.style.getTextMetrics()}},{key:"setTextMetrics",value:function(t,e){return this.style.setTextMetrics(t,e)}},{key:"toJSON",value:function(){var t=z.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}},{key:"setInteractive",value:function(t,e,n){var i=!!this.input;return At.prototype.setInteractive.call(this,t,e,n),i||this.canvasText.setInteractive(),this}},{key:"getWrappedText",value:function(t,e,n){return(t=this.canvasText.getText(t,e,n,!0)).split(_t)}},{key:"getPlainText",value:function(t,e,n){return this.canvasText.getPlainText(t,e,n)}},{key:"getText",value:function(t,e,n,i){return this.canvasText.getText(t,e,n,i=void 0===i?!1:i)}},{key:"getSubString",value:function(t,e,n){return this.getText(t,e,n)}},{key:"copyPenManager",value:function(t){return this.canvasText.copyPenManager(t)}},{key:"getPenManager",value:function(t,e){return this.canvasText.getPenManager(t,e)}},{key:"setSize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"resize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"lineSpacing",get:function(){return this.style.lineSpacing},set:function(t){this.setLineSpacing(t)}},{key:"imageManager",get:function(){return this._imageManager||(this._imageManager=new Ft(this.scene)),this._imageManager}},{key:"addImage",value:function(t,e){return this.imageManager.add(t,e),this}},{key:"drawAreaBounds",value:function(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}},{key:"measureTextMargins",value:function(t,e){return function(t,e,n){void 0===n&&(n={});var i=et.create(this),s=i.getContext("2d"),e=(t.syncFont(i,s),s.measureText(e)),r=Math.ceil(e.width*t.baselineX),a=2*r,e=r*t.baselineY|0;if(i.width=r,i.height=a,s.fillStyle="#f00",s.fillRect(0,0,r,a),s.font=t._font,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(t.testString,0,e),(n.left=0)!==r&&0!=a&&s.getImageData(0,0,r,a))for(var o=s.getImageData(0,0,r,a).data,l=!1,h=0;h<r;h++){for(var u=0;u<a;u++)if(255!==o[4*(u*r+h)]){n.left=h,l=!0;break}if(l)break}return et.remove(i),n}(this.style,t,e)}},{key:"generateTexture",value:function(t,e,n,i,s){var r,a,o,l=this.canvas;return void 0===i?i=l.width:i*=this.resolution,void 0===s?s=l.height:s*=this.resolution,r=this.scene,l=l,t=t,e=e,n=n,i=i,s=s,a=r.sys.textures,r=r.renderer,void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=l.width),void 0===s&&(s=l.height),(t=(a=a.exists(t)?a.get(t):a.createCanvas(t,i,s)).getSourceImage()).width!==i&&(t.width=i),t.height!==s&&(t.height=s),(o=t.getContext("2d")).clearRect(0,0,i,s),o.drawImage(l,e,n,i,s),r.gl&&a&&r.canvasToTexture(t,a.source[0].glTexture,!0,0),this}}]),h}(),z=Phaser.GameObjects.Components,jt=(Phaser.Class.mixin(Bt,[z.Alpha,z.BlendMode,z.ComputedSize,z.Crop,z.Depth,z.Flip,z.GetBounds,z.Mask,z.Origin,z.Pipeline,z.ScrollFactor,z.Tint,z.Transform,z.Visible,J]),{plainText:null,prevProp:null}),Ht=new Z,Xt=function(){function e(t){c(this,e),this.tags=t=void 0===t?{}:t}return s(e,[{key:"addTag",value:function(t,e){this.tags[t]=e}},{key:"getTag",value:function(t){return this.tags[t]}},{key:"splitText",value:function(t,e){for(var n=[],i=0;;){var s=Dt.exec(t);if(!s)break;var r,s=s[0],a=Dt.lastIndex-s.length;i<a&&n.push(t.substring(i,a)),void 0===e?n.push(s):1===e&&(Ut.test(s)?(r=s.match(Vt),n.push(r[2])):Nt.test(s)&&(r=s.match(Jt),n.push(r[2]))),i=Dt.lastIndex}var o=t.length;return i<o&&n.push(t.substring(i,o)),n}},{key:"tagTextToProp",value:function(t,e){Ut.test(t)?null!=(s=t.match(Vt))&&(n=s[1],(i=(i=this.tags).hasOwnProperty(n)?i[n]:{})._class=n,n=s[2]):Nt.test(t)&&null!=(s=t.match(Jt))&&(r=s[1],(i=Yt(r))._style=r,n=s[2]),null==i&&(i={});var n,i,s,r=jt;return r.plainText=n=null==n?t:n,r.prop=i,r}},{key:"propToContextStyle",value:function(t,e){var n,i=Ht;return e.hasOwnProperty("img")?i.image=e.img:(i.image=null,e.hasOwnProperty("family")||e.hasOwnProperty("fontFamily")||e.hasOwnProperty("font-family")?(n=e.hasOwnProperty("family")?e.family:e.hasOwnProperty("fontFamily")?e.fontFamily:e["font-family"],i.fontFamily=n):i.fontFamily=t.fontFamily,e.hasOwnProperty("size")||e.hasOwnProperty("fontSize")||e.hasOwnProperty("font-size")?("number"==typeof(n=e.hasOwnProperty("size")?e.size:e.hasOwnProperty("fontSize")?e.fontSize:e["font-size"])&&(n="".concat(n,"px")),i.fontSize=n):i.fontSize=t.fontSize,e.hasOwnProperty("style")||e.hasOwnProperty("fontStyle")||e.hasOwnProperty("font-style")?(n=e.hasOwnProperty("style")?e.style:e.hasOwnProperty("fontStyle")?e.fontStyle:e["font-style"],i.fontStyle=n):i.fontStyle=t.fontStyle,e.hasOwnProperty("color")||e.hasOwnProperty("font-color")?(n=e.hasOwnProperty("color")?e.color:e["font-color"],i.color=n):i.color=t.color,e.hasOwnProperty("stroke")?(n=e.stroke,i.stroke=n.hasOwnProperty("color")?n.color:t.stroke,i.strokeThickness=n.hasOwnProperty("thickness")?n.thickness:t.strokeThickness):(i.stroke=t.stroke,i.strokeThickness=t.strokeThickness)),e.hasOwnProperty("shadow")?(n=e.shadow,i.shadowColor=n.hasOwnProperty("color")?n.color:t.shadowColor,i.shadowOffsetX=n.hasOwnProperty("offsetX")?n.offsetX:t.shadowOffsetX,i.shadowOffsetY=n.hasOwnProperty("offsetY")?n.offsetY:t.shadowOffsetY,i.shadowBlur=n.hasOwnProperty("blur")?n.blur:t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=t.shadowStroke,i.shadowFill=t.shadowFill),e.hasOwnProperty("u")||e.hasOwnProperty("underline")?(n=e.hasOwnProperty("u")?e.u:e.underline,i.underlineColor=n.hasOwnProperty("color")?n.color:t.underlineColor,i.underlineThickness=n.hasOwnProperty("thickness")?n.thickness:t.underlineThickness,i.underlineOffset=n.hasOwnProperty("offset")?n.offset:t.underlineOffset):(i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset),i}},{key:"getStrokeThinkness",value:function(t,e){return e.hasOwnProperty("stroke")&&(e=e.stroke).hasOwnProperty("thickness")?e.thickness:t.strokeThickness}},{key:"propToTagText",value:function(t,e,n){return e.hasOwnProperty("_class")?""===t&&this.isTextTag(e._class)?"":"<class='".concat(e._class,"'>").concat(t,"</class>"):e.hasOwnProperty("_style")?"<style='".concat(e._style,"'>").concat(t,"</style>"):t}},{key:"destroy",value:function(){this.tags=void 0}},{key:"isTextTag",value:function(t){t=this.tags[t];return!!t&&null==t.img}}]),e}(),Yt=function(t){for(var e,n,i={},s=0,r=(t=t.split(";")).length;s<r;s++)if(n=(e=t[s].split(":"))[0],o=e[1],!Gt(n)&&!Gt(o)){switch(n){case"stroke":var a=o.split(" "),o={};1<=(l=a.length)&&(o.color=a[0]),2<=l&&(o.thickness=parseInt(a[1].replace("px","")));break;case"shadow":a=o.split(" ");o={},1<=(l=a.length)&&(o.color=a[0]),2<=l&&(o.offsetX=parseInt(a[1].replace("px",""))),3<=l&&(o.offsetY=parseInt(a[2].replace("px",""))),4<=l&&(o.blur=parseInt(a[3].replace("px","")));break;case"u":case"underline":var l,h=o.split(" ");o={},1<=(l=h.length)&&(o.color=h[0]),2<=l&&(o.thickness=parseInt(h[1].replace("px",""))),3<=l&&(o.offset=parseInt(h[2].replace("px","")));break;case"y":o=parseFloat(o)}i[n]=o}return i},Gt=function(t){return 0===(t=t.replace(Kt,"")).length},Dt=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,Ut=/<\s*class=/i,Vt=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,Nt=/<\s*style=/i,Jt=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,Kt=/^\s+|\s+$/,Et=Phaser.Utils.Objects.GetValue,$t=function(){t(o,Bt);var a=e(o);function o(t,e,n,i,s){c(this,o);var r=Et(s,"tags",void 0),r=new Xt(r);return a.call(this,t,e,n,i,s,"rexTagText",r)}return s(o,[{key:"addTag",value:function(t,e){return this.parser.addTag(t,e),this.updateText(!0)}},{key:"addTags",value:function(t){for(var e in t)this.parser.addTag(e,t[e]);return this.updateText(!0)}},{key:"getTag",value:function(t){return this.parser.getTag(t)}},{key:"preDestroy",value:function(){j(r(o.prototype),"preDestroy",this).call(this),this.parser.destroy(),this.parser=void 0}}]),o}();function qt(t,e,n,i){t=new $t(this.scene,t,e,n,i);return this.scene.add.existing(t),t}var _=Phaser.Utils.Objects.GetAdvancedValue,Qt=Phaser.GameObjects.BuildGameObject;function Zt(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var e=_(t,"text",""),n=_(t,"style",null),i=_(t,"padding",null),i=(null!==i&&(n.padding=i),new $t(this.scene,0,0,e,n));return Qt(this.scene,i,t),i.autoRound=_(t,"autoRound",!0),i}var te=function(t){return null==t||""===t||0===t.length},l=function(){t(i,Phaser.Plugins.BasePlugin);var n=e(i);function i(t){var e;return c(this,i),e=n.call(this,t),t.registerGameObject("rexTagText",qt,Zt),e}return s(i,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),i}();return function(t,e,n,i){if(void 0===i&&(i="."),"object"===u(t)){if(te(e)){if(null==n)return;"object"===u(n)&&(t=n)}else{i=(e="string"==typeof e?e.split(i):e).pop();(function(t,e,n){var i=t;if(!te(e))for(var s,r=0,a=(e="string"==typeof e?e.split("."):e).length;r<a;r++)null!=i[s=e[r]]&&"object"===u(i[s])||(i[s]=r!==a-1||void 0===n?{}:n),i=i[s];return i})(t,e)[i]=n}}}(window,"RexPlugins.GameObjects.TagText",$t),l});
